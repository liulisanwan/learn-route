# 10.é«˜çº§ç‰¹æ€§

# ğŸ’å‰ç½®å’Œåç½®ç»„ä»¶

LiteFlowæ”¯æŒäº†å‰ç½®ç»„ä»¶å’Œåç½®ç»„ä»¶ç‰¹æ€§ã€‚

æ­¤ç‰¹æ€§é’ˆå¯¹æ•´ä¸ªé“¾è·¯ï¼Œåœ¨é“¾è·¯ä¹‹å‰ä¹‹åå›ºå®šæ‰§è¡ŒæŸäº›ç»„ä»¶ã€‚ç”¨äºä¸šåŠ¡çš„å‰ç½®å¤„ç†å’Œåç½®å¤„ç†ã€‚

å‰ç½®ç»„ä»¶å’Œåç½®ç»„ä»¶ï¼Œå‡ä¸ºä¸²è¡ŒèŠ‚ç‚¹ï¼Œç›®å‰ä¸æ”¯æŒå¼‚æ­¥ã€‚

## [#](https://liteflow.yomahub.com/pages/9f93be/#å‰ç½®ç»„ä»¶)å‰ç½®ç»„ä»¶

å›ºå®šåœ¨ä¸€ä¸ªæµç¨‹å¼€å§‹ä¹‹å‰æ‰§è¡ŒæŸäº›èŠ‚ç‚¹ï¼Œè§„åˆ™è¡¨è¾¾å¼ä¸­ç”¨`PRE`å…³é”®å­—(å¿…é¡»å¤§å†™)æ¥è¡¨ç¤º:

```xml
<chain name="chain1">
    THEN(
        PRE(p1, p2), 
        a, b, c, 
        WHEN(d, e)
    );
</chain>
```

## [#](https://liteflow.yomahub.com/pages/9f93be/#åç½®èŠ‚ç‚¹)åç½®èŠ‚ç‚¹

å›ºå®šåœ¨ä¸€ä¸ªæµç¨‹ç»“æŸåæ‰§è¡ŒæŸäº›èŠ‚ç‚¹ï¼Œè¦æ³¨æ„çš„æ˜¯åç½®èŠ‚ç‚¹ä¸å—Exceptionå½±å“ï¼Œå³ä¾¿èŠ‚ç‚¹å‡ºé”™ï¼Œåç½®èŠ‚ç‚¹ä¾æ—§ä¼šæ‰§è¡Œã€‚åœ¨è§„åˆ™è¡¨è¾¾å¼ä¸­ç”¨`FINALLY`å…³é”®å­—(å¿…é¡»å¤§å†™)è¡¨ç¤ºï¼š

```xml
<chain name="chain1">
    THEN(
        a, b, c, 
        FINALLY(f1, f2)
    );
</chain>
```

## [#](https://liteflow.yomahub.com/pages/9f93be/#é¡ºåºé—®é¢˜)é¡ºåºé—®é¢˜

å‰ç½®èŠ‚ç‚¹ä¸€å®šè¦å†™åœ¨å‰é¢å—ï¼Ÿåç½®èŠ‚ç‚¹ä¸€å®šè¦å†™åœ¨æœ€åå—ï¼Ÿ

å¹¶ä¸æ˜¯ï¼Œ`PRE`å’Œ`FINALLY`å¯ä»¥å†™åœ¨ä»»æ„åœ°æ–¹ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```xml
<chain name="chain1">
    THEN(
        PRE(a), c, d, FINALLY(f1, f2)
    );
</chain>
```

ä¸‹é¢è¿™ä¸ªè¡¨è¾¾å¼å’Œä¸Šé¢æ˜¯ç­‰ä»·æ•ˆæœçš„, å³ä½¿ä¸æ”¾åœ¨ç›¸å¯¹åº”çš„ä½ç½®ï¼Œè¿˜æ˜¯ä¸€æ ·çš„æ•ˆæœã€‚

```xml
<chain name="chain1">
    THEN(
        FINALLY(f1, f2), c, PRE(a), d
    );
</chain>
```

## [#](https://liteflow.yomahub.com/pages/9f93be/#å±‚çº§å’ŒèŒƒå›´)å±‚çº§å’ŒèŒƒå›´

LiteFlow 2.9.5ä¸­èƒ½æ”¯æŒ`PRE`å’Œ`FINALLY`å†™åœ¨è¡¨è¾¾å¼çš„ä»»æ„å±‚çº§ã€‚ä¹Ÿæ„å‘³ç€ä½ åœ¨å­æµç¨‹ä¸­ï¼Œå­å˜é‡ä¸­ä¹Ÿå¯ä»¥ç”¨å‰ç½®å’Œåç½®ç»„ä»¶ã€‚

æç¤º

`PRE`å’Œ`FINALLY`åªèƒ½å†™åœ¨`THEN`è¡¨è¾¾å¼ä¸­ï¼Œå¦‚æœä½ å†™åœ¨`WHEN`è¡¨è¾¾å¼ä¸­æˆ–è€…å…¶ä»–è¯¸å¦‚`SWITCH`,`IF`çš„è¡¨è¾¾å¼ä¸­ï¼Œæ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ï¼Œè€Œä¸”è¿™æ ·å†™ä¹Ÿæ˜¯æ¯«æ— æ„ä¹‰çš„ã€‚è¿™ç‚¹éœ€è¦æ³¨æ„ä¸‹ã€‚

æ¯”å¦‚ä½ å¯ä»¥è¿™ä¹ˆå†™ï¼š

```xml
<chain name="chain6">
    c1 = THEN(PRE(p3, p4), THEN(a, b, c), FINALLY(f1, f2));
    THEN(PRE(p1, p2), c1, FINALLY(f3));
</chain>
```

æœ€ç»ˆæ‰§è¡Œç»“æœå°±æ˜¯ï¼š

```text
p1==>p2==>p3==>p4==>a==>b==>c==>f1==>f2==>f3
```

# ğŸŒæœ¬åœ°è§„åˆ™æ–‡ä»¶ç›‘å¬

é¦–å…ˆï¼Œåœ¨LiteFlowçš„é…ç½®`liteflow.rule-source`ä¸­ï¼Œä¸å…‰å¯ä»¥é…ç½®é¡¹ç›®å†…çš„è§„åˆ™æ–‡ä»¶ï¼Œå…¶å®è¿˜å¯ä»¥é…ç½®æœ¬åœ°ç£ç›˜ä¸Šçš„æ–‡ä»¶çš„ï¼Œæ¯”å¦‚ï¼š

```properties
liteflow.rule-source=/Users/bryan31/liteflow/test/flow.xml
```

ä½†æ˜¯å½“ä½ æœ¬åœ°è§„åˆ™æ–‡ä»¶æ”¹å˜äº†çš„æƒ…å†µä¸‹ï¼Œä½ çš„é¡¹ç›®æ˜¯æ— æ³•è·çŸ¥çš„ï¼Œä½ åªèƒ½é€šè¿‡æ‰‹åŠ¨åˆ·æ–°è§„åˆ™å»å®ç°çƒ­åˆ·æ–°(è¯¦ç»†è¯·é˜…è¯»[å¹³æ»‘çƒ­åˆ·æ–°](https://liteflow.yomahub.com/pages/204d71/))ã€‚

LiteFlowä»2.10.0å¼€å§‹ï¼Œå¢åŠ äº†å¯¹æœ¬åœ°è§„åˆ™æ–‡ä»¶ç›‘å¬çš„ç‰¹æ€§ã€‚

ä½ åªéœ€è¦é…ç½®`liteflow.enable-monitor-file=true`ï¼Œå³å¯å¼€å¯è‡ªåŠ¨å¯¹æ–‡ä»¶çš„ç›‘å¬ç‰¹æ€§ã€‚æ–‡ä»¶æ”¹åŠ¨ï¼Œä½ çš„é¡¹ç›®æ— éœ€åšä»»ä½•äº‹ï¼Œç«‹é©¬è‡ªåŠ¨åˆ·æ–°æ•´ä¸ªè§„åˆ™ã€‚éå¸¸æ–¹ä¾¿ã€‚

åœ¨å„ä¸ªç¯å¢ƒä¸­å¦‚ä½•é…ç½®ï¼Œå‰é¢çš„ç« èŠ‚ä¹Ÿæåˆ°è¿‡ï¼Œè¯¦æƒ…è¯·é˜…è¯»[é…ç½®é¡¹](https://liteflow.yomahub.com/pages/b70ec8/)è¿™ä¸€å¤§ç« èŠ‚ã€‚

# ğŸ¥ ç»„ä»¶é™çº§

LiteFlow ä» 2.11.1 ç‰ˆæœ¬å¼€å§‹æ”¯æŒç»„ä»¶é™çº§åŠŸèƒ½ã€‚

å¦‚æœä½ åœ¨ç¼–æ’æ—¶å†™äº†ä¸€ä¸ªä¸å­˜åœ¨çš„ç»„ä»¶ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ä¼šæŠ¥é”™çš„ã€‚

æ¯”å¦‚ä½ çš„ç³»ç»Ÿä¸­åªå®šä¹‰äº† Aï¼ŒBï¼ŒC ä¸‰ä¸ªç»„ä»¶ã€‚ä½†æ˜¯ä½ åœ¨è§„åˆ™é‡Œè¿™æ ·å†™ï¼š

```xml
<chain name="chain1">
    THEN(A, B, C, D);
</chain>
```

ç”±äº D ç»„ä»¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å¯åŠ¨æ—¶ä¼šæŠ¥é”™ã€‚

ç»„ä»¶é™çº§çš„æ„ä¹‰æ˜¯ï¼Œå½“ä½ å†™äº†ä¸€ä¸ªä¸å­˜åœ¨çš„ç»„ä»¶æ—¶ï¼Œåœ¨è¿è¡Œæ—¶ä¼šè‡ªåŠ¨è·¯ç”±åˆ°ä½ æŒ‡å®šçš„é™çº§ç»„ä»¶ä¸Šï¼Œç”±è¿™ä¸ªé™çº§ç»„ä»¶æ¥ä»£æ›¿ä½ ä¸å­˜åœ¨çš„ç»„ä»¶æ‰§è¡Œï¼Œè¿™æ ·å°±ä¸ä¼šæŠ¥é”™äº†ã€‚

## [#](https://liteflow.cc/pages/79289a/#ä½¿ç”¨æ–¹æ³•)ä½¿ç”¨æ–¹æ³•

é¦–å…ˆéœ€è¦åœ¨é…ç½®æ–‡ä»¶å¼€å¯ç»„ä»¶é™çº§åŠŸèƒ½ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ï¼š

```properties
liteflow.fallback-cmp-enable=true
```

è‹¥æƒ³å°†ä¸€ä¸ªç»„ä»¶å£°æ˜ä¸ºé™çº§ç»„ä»¶ï¼Œåªéœ€è¦åœ¨ç»„ä»¶ä¸Šæ·»åŠ  `@FallbackCmp` æ³¨è§£ã€‚ æ¯”å¦‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®šä¹‰ä¸€ä¸ªæ™®é€šç»„ä»¶çš„é™çº§ç»„ä»¶ Eã€‚

```java
@LiteflowComponent("E")
@FallbackCmp
public class ECmp extends NodeComponent {
    @Override
    public void process() {
        System.out.println("ECmp executed!");
    }
}
```

è‹¥æƒ³ä½¿ç”¨é™çº§ç»„ä»¶ï¼Œè§„åˆ™æ–‡ä»¶éœ€è¦è¿™ä¹ˆå†™ï¼š

```xml
<chain name="chain1">
    THEN(A, B, C, node("D"));
</chain>
```

å½“ç»„ä»¶ D ä¸å­˜åœ¨æ—¶ï¼Œä¼šé™çº§ä¸ºç»„ä»¶ E è¿è¡Œã€‚

æç¤º

å¦‚æœä¸åŠ  node å…³é”®å­—ï¼Œæ˜¯ä¸ä¼šè‡ªåŠ¨è·¯ç”±åˆ°é™çº§ç»„ä»¶çš„ï¼Œæ‰€ä»¥ä¸€å®šå¾—åŠ ã€‚

com.yomahub.liteflow.flow.FlowBus

æ‰«æåŒ…ä¸‹ä½¿ç”¨FallbackCmpæ³¨è§£ç±»ï¼Œæ·»åŠ åˆ°mapé›†åˆ

```java
// åˆ¤æ–­æ˜¯å¦æ˜¯é™çº§ç»„ä»¶ï¼Œå¦‚æœæ˜¯åˆ™æ·»åŠ åˆ° fallbackNodeMap
	private static void addFallbackNode(Node node) {
		NodeComponent nodeComponent = node.getInstance();
		FallbackCmp fallbackCmp = AnnoUtil.getAnnotation(nodeComponent.getClass(), FallbackCmp.class);
		if (fallbackCmp == null) {
			return;
		}

		NodeTypeEnum nodeType = node.getType();
		fallbackNodeMap.put(nodeType, node);
	}
```

com.yomahub.liteflow.flow.element.FallbackNodeProxy

æ‰¾åˆ°ç›¸åº”çš„é™çº§æ‰§è¡ŒèŠ‚ç‚¹

```java
private Node findFallbackNode(Condition condition) {
        ConditionTypeEnum conditionType = condition.getConditionType();
        switch (conditionType) {
            case TYPE_THEN:
            case TYPE_WHEN:
            case TYPE_PRE:
            case TYPE_FINALLY:
            case TYPE_CATCH:
                return FlowBus.getFallBackNode(NodeTypeEnum.COMMON);
            case TYPE_IF:
                return findNodeInIf((IfCondition) condition);
            case TYPE_SWITCH:
                return findNodeInSwitch((SwitchCondition) condition);
            case TYPE_FOR:
                return findNodeInFor((ForCondition) condition);
            case TYPE_WHILE:
                return findNodeInWhile((WhileCondition) condition);
            case TYPE_ITERATOR:
                return findNodeInIterator((IteratorCondition) condition);
            case TYPE_NOT_OPT:
            case TYPE_AND_OR_OPT:
                return FlowBus.getFallBackNode(NodeTypeEnum.IF);
            default:
                return null;
        }
    }
```

com.yomahub.liteflow.builder.el.operator.NodeOperator

æ²¡æœ‰æ‰¾åˆ°èŠ‚ç‚¹å°±å»æ‰§è¡Œä»£ç†èŠ‚ç‚¹

```java
public Node build(Object[] objects) throws Exception {
        OperatorHelper.checkObjectSizeEqOne(objects);
        String nodeId = OperatorHelper.convert(objects[0], String.class);

        if (FlowBus.containNode(nodeId)) {
            // æ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹
            return FlowBus.getNode(nodeId);
        } else {
            // ç”Ÿæˆä»£ç†èŠ‚ç‚¹
            return new FallbackNodeProxy(nodeId);
        }
    }
```



## [#](https://liteflow.cc/pages/79289a/#å¤šç»„ä»¶ç±»å‹çš„æ”¯æŒ)å¤šç»„ä»¶ç±»å‹çš„æ”¯æŒ

LiteFlow ä¸ä»…æ”¯æŒæ™®é€šç»„ä»¶çš„é™çº§ï¼Œå¯¹å…¶ä»–ç»„ä»¶ç±»å‹ä¹Ÿæä¾›äº†æ”¯æŒã€‚ä»¥ä¸‹ç¤ºä¾‹åˆ†åˆ«å£°æ˜äº†ä¸€ä¸ªæ¡ä»¶é™çº§ç»„ä»¶å’Œæ¬¡æ•°å¾ªç¯é™çº§ç»„ä»¶ã€‚

```java
@LiteflowComponent("if1")
@FallbackCmp
public class IfCmp1 extends NodeIfComponent {
    @Override
    public boolean processIf() throws Exception {
        return false;
    }
}
@LiteflowComponent("for1")
@FallbackCmp
public class ForCmp extends NodeForComponent {
    @Override
    public int processFor() throws Exception {
        return 3;
    }
} 
```

å¯¹äºå¦‚ä¸‹çš„ EL è¡¨è¾¾å¼ï¼š

```xml
<chain name="chain2">
    IF(node("x1"), FOR("x2").DO(node("x3")));
</chain>
```

å½“ç»„ä»¶ x1ã€x2 æˆ– x3 ä¸å­˜åœ¨æ—¶ï¼Œä¼šåˆ†åˆ«è·¯ç”±åˆ°æ¡ä»¶é™çº§ç»„ä»¶ã€æ¬¡æ•°å¾ªç¯é™çº§ç»„ä»¶ä»¥åŠæ™®é€šé™çº§ç»„ä»¶ã€‚å…¶ä»–ç±»å‹çš„ç»„ä»¶ä¹ŸåŒç†ã€‚

ä¸æˆ–éè¡¨è¾¾å¼ä¹Ÿå¯ä»¥ä½¿ç”¨é™çº§ç»„ä»¶ï¼Œå¦‚ä¸‹çš„ EL è¡¨è¾¾å¼ï¼š

```xml
<chain name="chain3">
    IF(AND(node("x"), a), b);
</chain>
```

å½“ç»„ä»¶ x ä¸å­˜åœ¨æ—¶ä¼šè·¯ç”±åˆ°æ¡ä»¶é™çº§ç»„ä»¶ã€‚

æç¤º

ç›®å‰æ¯ç§ç±»å‹çš„ç»„ä»¶åªå…è®¸å®šä¹‰ä¸€ä¸ªé™çº§ç»„ä»¶ã€‚

# ğŸ‰ç»„ä»¶å‚æ•°

LiteFlowä»v2.9.0å¼€å§‹æ”¯æŒäº†ç»„ä»¶å‚æ•°ç‰¹æ€§ï¼Œä½ å¯ä»¥åœ¨ELè¯­æ³•ä¸­æ¥ç»™ç»„ä»¶è®¾ç½®å¤–ç½®å‚æ•°ã€‚

è¿™å¯¹äºç›¸åŒç»„ä»¶çš„ç¼–æ’æ˜¯éå¸¸æœ‰ç”¨çš„ç‰¹æ€§ã€‚

ä½ å¯ä»¥ä½¿ç”¨`data`å…³é”®å­—æ¥ç»™æŸä¸ªç»„ä»¶è®¾ç½®å¤–ç½®å‚æ•°ï¼Œå»ºè®®æœ€å¥½æ˜¯JSONæ ¼å¼ï¼š

```xml
<flow>
    <chain name="chain1">
        cmpData = '{"name":"jack","age":27,"birth":"1995-10-01"}';
    
        THEN(a, b.data(cmpData), c);
    </chain>
    
    <chain name="chain2">
        cmpData = '{"name":"rose","age":20,"birth":"1997-07-01"}';
    
        WHEN(c, b.data(cmpData));
    </chain>
</flow>
```

ä¸Šè¿°è¡¨è¾¾å¼ä¸­ï¼ŒåŒä¸€ä¸ªbç»„ä»¶ï¼Œåœ¨ä¸åŒçš„chainä¸­è¢«èµ‹äºˆäº†ä¸åŒçš„å¤–ç½®å‚æ•°ï¼Œè¿è¡Œä¸­åœ¨ç»„ä»¶ä¸­é€šè¿‡`getCmpData`æ–¹æ³•ä¹Ÿèƒ½æ‹¿åˆ°ç›¸åº”çš„å‚æ•°ã€‚

è¿™ä¸ªæ–¹æ³•æ˜¯å¯ä»¥è¿”å›å¯¹åº”ç»“æ„çš„javaå¯¹è±¡çš„ï¼Œåªè¦ä¼ å…¥ç›¸å¯¹åº”çš„classå³å¯ã€‚

```java
@Component("b")
public class BCmp extends NodeComponent {

	@Override
	public void process() {
		User user = this.getCmpData(User.class);
		...
	}

}
```

# ğŸ‘ç»„ä»¶åˆ«å

LiteFlowæ”¯æŒäº†ç»„ä»¶åˆ«åçš„è®¾ç½®ï¼Œä¸€èˆ¬ç”¨æ¥å¡«å†™ä¸­æ–‡åç§°ï¼Œæ–¹ä¾¿è®°å¿†çš„åç§°ã€‚

è®¾ç½®äº†ç»„ä»¶åˆ«åï¼Œåœ¨æ‰“å°å‡ºæ­¥éª¤ä¿¡æ¯çš„æ—¶å€™ï¼Œä¼šå¸¦ä¸Šç›¸åº”åˆ«åã€‚

ç»„ä»¶åˆ«åçš„è®¾ç½®åˆ†ä¸¤ç§æƒ…å†µ

## [#](https://liteflow.yomahub.com/pages/92ef89/#springboot-spring-æ‰«ææ–¹å¼)Springboot & Spring æ‰«ææ–¹å¼

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¾ˆå¤šäººä½¿ç”¨çš„éƒ½æ˜¯springboot/springæ¡†æ¶ï¼Œé‚£ä¹ˆåªéœ€è¦åšå¦‚ä¸‹æ”¹å˜

ä½ å®šä¹‰çš„ç»„ä»¶ä¸­ï¼ŒæŠŠ`@Component`æ¢æˆ`@LiteflowComponent`ï¼Œå¹¶åšå¦‚ä¸‹å®šä¹‰ï¼š

```java
@LiteflowComponent(id = "a", name = "ç»„ä»¶A")
public class ACmp extends NodeComponent {

	@Override
	public void process() {
		System.out.println("ACmp executed!");
	}
}
```

## [#](https://liteflow.yomahub.com/pages/92ef89/#è§„åˆ™æ–‡ä»¶æ–¹å¼å®šä¹‰ç»„ä»¶)è§„åˆ™æ–‡ä»¶æ–¹å¼å®šä¹‰ç»„ä»¶

åœ¨éspringä½“ç³»çš„å·¥ç¨‹é‡Œï¼Œç»„ä»¶æ˜¯éœ€è¦å®šä¹‰åœ¨è§„åˆ™æ–‡ä»¶é‡Œçš„ï¼Œé‚£ä¹ˆéœ€è¦åšå¦‚ä¸‹æ·»åŠ 

éœ€è¦åœ¨`<node>`èŠ‚ç‚¹ä¸­åŠ å…¥nameçš„å±æ€§

```xml
<node id="a" name="ç»„ä»¶A" class="com.yomahub.liteflow.test.config.cmp.ACmp"/>
<node id="b" name="ç»„ä»¶B" class="com.yomahub.liteflow.test.config.cmp.BCmp"/>
```

## [#](https://liteflow.yomahub.com/pages/92ef89/#æ‰“å°)æ‰“å°

å…³äºåˆ«åçš„æ‰“å°è¯·å‚ç…§[æ‰“å°ä¿¡æ¯è¯¦è§£](https://liteflow.yomahub.com/pages/4d614c/)ã€‚

# ğŸç»„ä»¶æ ‡ç­¾

`tag`æœ‰2ç§ç”¨é€”ï¼š

- ç”¨äº`SWITCH`è¯­æ³•çš„é€‰æ‹©
- èµ‹å€¼

å…³äº`SWITCH`çš„é€‰æ‹©`tag`æ ‡ç­¾å†…å®¹è¯·å‚è€ƒ[é€‰æ‹©ç¼–æ’](https://liteflow.yomahub.com/pages/d90483/)è¿™ä¸€ç« ã€‚

è¿™ç« ä¸»è¦é˜è¿°`tag`æ ‡ç­¾çš„èµ‹å€¼åŠŸèƒ½ã€‚

ä½ å¯ä»¥åœ¨è§„åˆ™è¡¨è¾¾å¼é‡Œç»™æ¯ä¸ªç»„ä»¶æ·»åŠ è¿è¡Œæ—¶çš„æ ‡ç­¾å€¼ï¼Œç”¨`tag`å…³é”®å­—è¡¨ç¤ºï¼š

```xml
<chain name="chain1">
    THEN(
        a.tag("tag1"),
        b.tag("tag2"),
        c.tag("tag3")
    );
</chain>
```

è¿™æ ·ï¼Œä½ åœ¨ä»£ç é‡Œå¯ä»¥é€šè¿‡`this.getTag()`è·å–åˆ°å½“å‰çš„æ ‡ç­¾ï¼Œè¿™åœ¨æœ‰äº›æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯å½“å¤šä¸ªç›¸åŒç»„ä»¶ç¼–æ’æ—¶ï¼Œä½ å¯ä»¥æ ¹æ®`tag`æ¥è·çŸ¥åˆ°ä¸åŒçš„å‚æ•°ã€‚æˆ–è€…æ ¹æ®tagæ ‡ç­¾æ¥ç»™ç›¸åŒçš„ç»„ä»¶ä½œä¸åŒçš„åˆ¤æ–­ã€‚

```java
@LiteflowComponent("b")
public class BCmp extends NodeComponent {
    @Override
    public void process() {
        String tag = this.getTag();
        ...
    }
}
```

å½“ç„¶ï¼Œä»¥ä¸‹è¿™ç§ä¾‹å­ä¹Ÿæ˜¯å¯ä»¥çš„:

```xml
<chain name="chain1">
    THEN(
        a.tag("1"), a.tag("2"), a.tag("3"), a.tag("4"), a.tag("5"), a.tag("6")
    );
</chain>
```

# ğŸ¥ç»„ä»¶äº‹ä»¶å›è°ƒ

LiteFlowæ”¯æŒäº†ç»„ä»¶äº‹ä»¶å›è°ƒã€‚ç›®å‰æ”¯æŒçš„äº‹ä»¶æœ‰2ä¸ªï¼Œç»„ä»¶æˆåŠŸäº‹ä»¶å’Œå¤±è´¥äº‹ä»¶ã€‚

## [#](https://liteflow.yomahub.com/pages/3ee755/#æˆåŠŸäº‹ä»¶)æˆåŠŸäº‹ä»¶

å¦‚æœä½ åœ¨ç»„ä»¶é‡Œè¦†ç›–äº†`onSuccess`æ–¹æ³•ï¼Œé‚£ä¹ˆç»„ä»¶æˆåŠŸåä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•ã€‚

```java
@LiteflowComponent("a")
public class ACmp extends NodeComponent {

	@Override
	public void process() {
		DefaultContext context = this.getContextBean(DefaultContext.class);
		//do your biz
	}

	@Override
	public void onSuccess() throws Exception {
		DefaultContext context = this.getContextBean(DefaultContext.class);
		//do your biz
	}
}
```

åœ¨æˆåŠŸäº‹ä»¶é‡Œï¼Œä½ å¯ä»¥é€šè¿‡åŒæ ·çš„æ–¹æ³•è·å–åˆ°ä¸Šä¸‹æ–‡ã€‚

## [#](https://liteflow.yomahub.com/pages/3ee755/#å¤±è´¥äº‹ä»¶)å¤±è´¥äº‹ä»¶

å¦‚æœä½ åœ¨ç»„ä»¶ä¸­è¦†ç›–äº†`onError`æ–¹æ³•ï¼Œé‚£ä¹ˆç»„ä»¶å‘ç”Ÿå¼‚å¸¸åä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•ã€‚

```java
@Component("d")
public class DCmp extends NodeComponent {

	@Override
	public void process() throws Exception{
		//mock throw exception
		throw new NullPointerException();
	}

	@Override
	public void onError(Exception e) throws Exception {
		DefaultContext context = this.getContextBean(DefaultContext.class);
		//do your biz
	}
}
```

### [#](https://liteflow.yomahub.com/pages/3ee755/#æ³¨æ„ç‚¹1)æ³¨æ„ç‚¹1

`onError`æ–¹æ³•æ‰§è¡Œåï¼Œå› ä¸ºä¸»æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥æ•´ä¸ªæµç¨‹ä¾æ—§æ˜¯å¤±è´¥çŠ¶æ€ã€‚responseå¯¹è±¡é‡Œä¾æ—§æ˜¯ä¸»æ–¹æ³•æŠ›å‡ºçš„é”™ã€‚

### [#](https://liteflow.yomahub.com/pages/3ee755/#æ³¨æ„ç‚¹2)æ³¨æ„ç‚¹2

å¦‚æœ`onError`æ–¹æ³•æœ¬èº«æŠ›é”™ï¼Œé‚£ä¹ˆæœ€ç»ˆæŠ›åˆ°æœ€å¤–é¢çš„é”™ï¼Œæ˜¯ä¸»æ–¹æ³•é‡Œçš„é”™ï¼Œè€Œ`onError`æ–¹æ³•æ‰€äº§ç”Ÿçš„å¼‚å¸¸ä¼šè¢«æ‰“å‡ºå †æ ˆï¼Œä½†ä¸ä¼šæŠ›å‡ºã€‚æ¯”å¦‚ï¼š

```java
@Component("d")
public class DCmp extends NodeComponent {

	@Override
	public void process() throws Exception{
		//mock throw exception
		throw new NullPointerException();
	}

	@Override
	public void onError(Exception e) throws Exception {
		throw new IllegalAccessException("é”™è¯¯äº‹ä»¶å›è°ƒæœ¬èº«æŠ›å‡ºå¼‚å¸¸");
	}
}
```

é‚£ä¹ˆæœ€ç»ˆresponseé‡Œçš„å¼‚å¸¸ä¼šæ˜¯`NullPointerException`è€Œä¸æ˜¯`IllegalAccessException`ï¼Œä½†æ˜¯`IllegalAccessException`è¿™ä¸ªå¼‚å¸¸ä¼šè¢«æ‰“å‡ºå †æ ˆä¿¡æ¯ã€‚

### [#](https://liteflow.yomahub.com/pages/3ee755/#æ³¨æ„ç‚¹3)æ³¨æ„ç‚¹3

`onError`æ–¹æ³•æ‰§è¡Œåï¼Œ`afterProcess`æ–¹æ³•è¿˜ä¼šæ‰§è¡Œå—ï¼ˆå‡è®¾éƒ½æœ‰å®ç°ï¼‰ï¼Ÿ

ä¼šçš„ï¼Œæ— è®ºæ˜¯å¦æŠ›å‡ºé”™ï¼Œ`afterProcess`æ–¹æ³•éƒ½ä¼šè¢«æ‰§è¡Œã€‚

# ğŸ¥‘éšå¼å­æµç¨‹

LiteFlowæ”¯æŒåœ¨ä¸€ä¸ªèŠ‚ç‚¹é‡Œé€šè¿‡ä»£ç è°ƒç”¨å¦å¤–ä¸€æ¡æµç¨‹ï¼Œ è¿™ä¸ªæµç¨‹å…³ç³»åœ¨è§„åˆ™æ–‡ä»¶ä¸­å¹¶ä¸ä¼šæ˜¾ç¤ºã€‚æ‰€ä»¥è¿™é‡Œç§°ä¹‹ä¸ºéšå¼è°ƒç”¨ã€‚

ä¸»æµç¨‹å’Œéšå¼å­æµç¨‹å…±åŒäº«æœ‰åŒä¸€ä¸ªä¸Šä¸‹æ–‡çš„æ•°æ®ã€‚æ‰€ä»¥éšå¼å­æµç¨‹é‡Œä¹Ÿå®Œå…¨å¯ä»¥æ‹¿åˆ°è¿™ä¸ªè¯·æ±‚ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚

éšå¼è°ƒç”¨å¯ä»¥å®Œæˆæ›´ä¸ºå¤æ‚çš„å­æµç¨‹ï¼Œæ¯”å¦‚å¾ªç¯è°ƒç”¨ï¼Œå¤æ‚æ¡ä»¶åˆ¤æ–­ç­‰ç­‰ã€‚éšå¼å­æµç¨‹éœ€è¦ä½ åœ¨ç»„ä»¶é‡Œé€šè¿‡`this.invoke`è¿™ä¸ªè¯­å¥æ¥è°ƒç”¨ã€‚

```java
@Component("h")
public class HComponent extends NodeComponent {

	@Override
	public void process() {
		System.out.println("Hcomponent executed!");
        for(int i=0;i<10;i++){
            this.invoke("strategy1","éšå¼æµç¨‹çš„åˆå§‹å‚æ•°ï¼Œå¯ä¸ºnull");
        }
	}
}
```

è¿™æ®µä»£ç æ¼”ç¤ºäº†åœ¨æŸä¸ªä¸šåŠ¡èŠ‚ç‚¹å†…å¾ªç¯è°ƒç”¨å¦å¤–ä¸€ä¸ªæµç¨‹é“¾çš„æ–¹æ³•ã€‚

æç¤º

è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ åœ¨ç»„ä»¶é‡Œå¦å¤–å¼€çº¿ç¨‹å»è°ƒç”¨éšå¼ç»„ä»¶ï¼Œæ¨èç”¨`invokeInAsync`æ–¹æ³•ã€‚

åŒæ ·ï¼Œéšå¼å­æµç¨‹ä¹Ÿæ”¯æŒè¿”å›`LiteFlowResponse`å¯¹è±¡ï¼Œéœ€è¦è°ƒç”¨`invoke2Resp`æ–¹æ³•ï¼Œå…³äºè¿”å›å¯¹è±¡ä¸º`LiteFlowResponse`çš„è¯´æ˜ï¼Œè¯·å‚ç…§[LiteflowResponseå¯¹è±¡](https://liteflow.yomahub.com/pages/9f653d/)ã€‚

æ³¨æ„

å¦‚æœä½ æ˜¯ç”¨`invoke`å»è°ƒç”¨éšå¼æµç¨‹ï¼Œåœ¨ç»„ä»¶ä¸­æ‹¿åˆ°ä¼ å…¥çš„éšå¼æµç¨‹è¯·æ±‚å‚æ•°ï¼Œé€šè¿‡`this.getSubChainReqData()`å»æ‹¿ã€‚

å¦‚æœä½ æ˜¯ç”¨`invokeInAsync`å»è°ƒç”¨éšå¼æµç¨‹ï¼Œåœ¨ç»„ä»¶ä¸­æ‹¿åˆ°ä¼ å…¥çš„éšå¼æµç¨‹è¯·æ±‚å‚æ•°ï¼Œè¯·é€šè¿‡`this.getSubChainReqDataInAsync()`å»æ‹¿ã€‚

ç”¨`this.getRequestData()`æ˜¯æ‹¿ä¸åˆ°çš„ï¼

# ğŸ•ç§æœ‰æŠ•é€’

LiteFlowæ”¯æŒç§æœ‰æŠ•é€’ç‰¹æ€§

## [#](https://liteflow.yomahub.com/pages/fbb938/#ä»€ä¹ˆå«ç§æœ‰æŠ•é€’)ä»€ä¹ˆå«ç§æœ‰æŠ•é€’

åœ¨ä¹‹å‰çš„ä»‹ç»ä¸­å·²ç»é˜è¿°äº†åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œå„ä¸ªLiteFLowçš„ç»„ä»¶éƒ½å…±äº«åŒä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚

åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œä¸Šä¸‹æ–‡é‡Œçš„æ‰€æœ‰æ•°æ®å¯¹è¿™ä¸ªè¯·æ±‚é“¾è·¯ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯å…¬å¼€çš„ã€‚æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥å­˜å–æ•°æ®ã€‚

ä½†æ˜¯å­˜åœ¨è¿™æ ·ä¸€ä¸ªæƒ…å†µï¼Œæ¯”å¦‚æˆ‘çš„è§„åˆ™æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<flow>
    <!-- 5ä¸ªç›¸åŒçš„bç»„ä»¶å¹¶å‘æ‰§è¡Œ -->
    <chain name="chain1">
        THEN(
            a,
            WHEN(b, b, b, b, b),
            c
        );
    </chain>
</flow>
```

åœ¨æ‰§è¡Œå®Œç»„ä»¶aä¹‹åï¼Œè¿›è¡Œäº†åŒæ ·çš„5ä¸ªbç»„ä»¶çš„å¹¶å‘ã€‚åœ¨bç»„ä»¶ä¸Šé€»è¾‘æ˜¯åŒä¸€å¥—ï¼Œä½†æ˜¯è¦æ¥æ”¶5ä¸ªä¸åŒçš„å‚æ•°ã€‚

æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä¹‹å‰çš„æè¿°ä¸­ï¼Œaç»„ä»¶å¯ä»¥å¾€ä¸Šä¸‹æ–‡é‡Œæ”¾æ•°æ®ï¼Œå…¶ä»–ç»„ä»¶å¯ä»¥å–åˆ°aç»„ä»¶å¾€ä¸Šä¸‹æ–‡æ”¾çš„ä¸œè¥¿ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæ™®é€šçš„å­˜æ”¾æ•°æ®æ˜¯æ— æ³•è®©bç»„ä»¶å–åˆ°5ä¸ªä¸åŒçš„å‚æ•°æ¥è¿›è¡Œå¹¶å‘å¤„ç†çš„ã€‚

æ¦‚å¿µ

æ‰€ä»¥ä¸ºæ­¤ï¼ŒLiteFlowç‰¹åœ°è®¾è®¡äº†ç§æœ‰æŠ•é€’çš„æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ï¼šä¸€ä¸ªç»„ä»¶å¯ä»¥æ˜¾ç¤ºçš„å£°æ˜ä¸ºæŸä¸ªç‰¹å®šçš„ç»„ä»¶å»æŠ•é€’1ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œè€ŒæŠ•é€’çš„å‚æ•°ï¼Œä¹Ÿåªæœ‰è¿™ä¸ªç‰¹å®šçš„ç»„ä»¶æ‰èƒ½è·å–åˆ°ï¼Œå…¶ä»–ç»„ä»¶æ˜¯è·å–ä¸åˆ°çš„ã€‚å¹¶ä¸”è¿™ä¸ªæŠ•é€’çš„å‚æ•°(ä¸€ä¸ªæˆ–å¤šä¸ª)åªèƒ½è¢«å–ä¸€æ¬¡ã€‚

æœ‰äº†è¿™ä¸ªç‰¹æ€§ï¼Œé‚£ä¸Šè¿°çš„åœºæ™¯å°±å¯ä»¥åˆ©ç”¨ç§æœ‰æŠ•é€’çš„ç‰¹æ€§å»è§£å†³äº†ã€‚

## [#](https://liteflow.yomahub.com/pages/fbb938/#è§£å†³æ–¹å¼)è§£å†³æ–¹å¼

æˆ‘ä»¬å…ˆå®šä¹‰ç»„ä»¶aï¼š

```java
@LiteflowComponent("a")
public class ACmp extends NodeComponent {
	@Override
	public void process() {
		System.out.println("ACmp executed!");
		DefaultContext context = this.getContextBean(DefaultContext.class);
		context.setData("testSet", new HashSet<>());

		for (int i = 0; i < 5; i++) {
			this.sendPrivateDeliveryData("b",i+1);
		}
	}
}
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸ºbç»„ä»¶è¿›è¡Œäº†ç§æœ‰æŠ•é€’ï¼Œè°ƒç”¨äº†`this.sendPrivateDeliveryData`æ–¹æ³•ï¼ŒæŒ‡å®šäº†bç»„ä»¶

ç„¶åæˆ‘ä»¬å†æ¥çœ‹bç»„ä»¶ï¼š

```java
@LiteflowComponent("b")
public class BCmp extends NodeComponent {
	@Override
	public void process() {
		System.out.println("BCmp executed!");
		Integer value = this.getPrivateDeliveryData();
		//do your biz
	}
}
```

bç»„ä»¶è°ƒç”¨äº†`this.getPrivateDeliveryData()`æ–¹æ³•ï¼Œè·å–äº†aç»„ä»¶æŠ•é€’çš„å‚æ•°ã€‚å› ä¸ºå‚æ•°åªèƒ½è¢«è·å–ä¸€æ¬¡ï¼ˆå†…éƒ¨ç”¨é˜Ÿåˆ—æ¥å®ç°ï¼‰ï¼Œæ‰€ä»¥ä¿è¯äº†æ¯ä¸ªbç»„ä»¶è·å–åˆ°çš„å‚æ•°éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚

# ğŸ£ç»„ä»¶é‡è¯•

LiteFLowæ”¯æŒç»„ä»¶çš„é‡è¯•

å…¶ä¸­åˆåˆ†å…¨å±€é‡è¯•å’Œå•ä¸ªç»„ä»¶é‡è¯•ï¼Œä¸‹é¢ä¸€ä¸€è¯´æ˜

## [#](https://liteflow.yomahub.com/pages/7e9da1/#å…¨å±€é‡è¯•)å…¨å±€é‡è¯•

å¦‚æœéœ€è¦å…¨å±€é‡è¯•ï¼Œä½ éœ€è¦åšå¦‚ä¸‹é…ç½®ï¼š

```properties
liteflow.retry-count=3
```

è¿™è¡¨æ˜ï¼Œå¦‚æœç»„ä»¶æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œä¼šé‡è¯•3æ¬¡ï¼Œå¦‚æœ3æ¬¡ä¹‹åä¾æ—§å¼‚å¸¸ï¼Œé‚£ä¹ˆæ•´æ¡æµç¨‹ç»“æŸã€‚

ä»¥ä¸‹å‡ ç§æƒ…å†µæµç¨‹ä¼šç»§ç»­ï¼š

å¦‚æœç»„ä»¶é‡Œè¦†ç›–äº†`isContinueOnError`ï¼Œè®¾ä¸ºtrueçš„è¯ï¼Œé‚£æµç¨‹ä¼šç»§ç»­ã€‚

å¼‚æ­¥æµç¨‹çš„è¯ï¼Œå¦‚æœ`WHEN`ä¸Šé…ç½®äº†`ignoreError`ä¸ºtrueçš„è¯(é»˜è®¤ä¸ºfalse)ï¼Œåˆ™ä¸‹ä¸€ä¸ªä¸åŒå¹¶è¡Œç»„ä¼šç»§ç»­ã€‚å…³äº`ignoreError`çš„å®šä¹‰å’Œä½¿ç”¨ï¼Œå¯ä»¥æŸ¥çœ‹[å¹¶è¡Œç¼–æ’](https://liteflow.yomahub.com/pages/b3446a/)ç« èŠ‚

## [#](https://liteflow.yomahub.com/pages/7e9da1/#å•ä¸ªç»„ä»¶é‡è¯•)å•ä¸ªç»„ä»¶é‡è¯•

LiteFlowè¿˜æä¾›äº†åŸºäºå•ä¸ªç»„ä»¶ï¼ŒæŒ‡å®šExceptionçš„é‡è¯•ç‰¹æ€§ï¼ŒLiteFlowä»2.6.0å¼€å§‹æä¾›äº†`@LiteflowRetry`æ ‡æ³¨

ä½ å¯ä»¥åœ¨æŒ‡å®šçš„ç»„ä»¶ä¸Šè¿›è¡Œæ ‡æ³¨ï¼š

```java
@LiteflowComponent("c")
@LiteflowRetry(5)
public class CCmp extends NodeComponent {
	@Override
	public void process() {
		//do your biz
	}
}
```

é‚£ä¹ˆï¼Œè¿™æ ·å°±è¡¨æ˜ï¼Œå¦‚æœè¿™ä¸ªç»„ä»¶æœ‰ä»»ä½•å¼‚å¸¸æŠ›å‡ºï¼Œåˆ™æœ€å¤šé‡è¯•5éã€‚å¦‚æœç¬¬5éé‡è¯•å†ä¸æˆåŠŸï¼Œé‚£å°±ä¼šçœŸæ­£æŠ›å‡ºä½ çš„ä¸šåŠ¡å¼‚å¸¸

åŒæ ·ï¼Œè¿˜å¯ä»¥åœ¨è¿™ä¸ªæ ‡æ³¨ä¸ŠæŒ‡å®šä¸€ä¸ªæˆ–è€…å¤šä¸ªå¼‚å¸¸ï¼š

```java
@LiteflowComponent("e")
@LiteflowRetry(retry = 5, forExceptions = {NullPointerException.class,IllegalArgumentException.class})
public class ECmp extends NodeComponent {
	@Override
	public void process() {
        //do your biz
	}
}
```

è¿™æ ·å°±è¡¨æ˜ï¼Œå¦‚æœè¿™ä¸ªç»„ä»¶æŠ›å‡ºçš„å¼‚å¸¸æ˜¯`NullPointerException`æˆ–è€…`IllegalArgumentException`ï¼ˆæˆ–è€…æ˜¯è¿™ä¸¤ä¸ªExceptionç±»çš„å­ç±»ï¼‰ï¼Œåˆ™ä¼šè¿›è¡Œæœ€å¤š5æ¬¡çš„å°è¯•ï¼Œæœ€åä¸€éå†ä¸æˆåŠŸï¼Œé‚£å°±ä¼šçœŸæ­£æŠ›å‡ºå¼‚å¸¸ã€‚

## [#](https://liteflow.yomahub.com/pages/7e9da1/#å…¨å±€é‡è¯•å’Œå•ä¸ªç»„ä»¶é‡è¯•éƒ½å®šä¹‰çš„æƒ…å†µä¸‹)å…¨å±€é‡è¯•å’Œå•ä¸ªç»„ä»¶é‡è¯•éƒ½å®šä¹‰çš„æƒ…å†µä¸‹

å¦‚æœåœ¨2è€…éƒ½å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆå–å•ä¸ªç»„ä»¶çš„é‡è¯•é…ç½®ã€‚æ²¡æœ‰çš„æƒ…å†µä¸‹ï¼Œå†å–å…¨å±€é…ç½®ã€‚

# ğŸ¥¯é“¾è·¯ç»§æ‰¿ğŸ§ª Beta

LiteFlowä»2.11.1ç‰ˆæœ¬èµ·ï¼Œæ”¯æŒchainä¹‹é—´çš„ç»§æ‰¿å…³ç³»ï¼Œä½¿å¾—chainä¹‹é—´å¯ä»¥è¿›è¡Œç»§æ‰¿å’Œæ‰©å±•ã€‚

â—**æ³¨æ„:** æœ¬ç‰¹æ€§ä¸º**Beta**å®éªŒæ€§åŠŸèƒ½ï¼Œä¸ä¿è¯åç»­å°ç‰ˆæœ¬å‡çº§èƒ½å¤Ÿå‘ä¸‹å…¼å®¹ã€‚

### [#](https://liteflow.cc/pages/524c43/#ä½¿ç”¨æ–¹æ³•)ä½¿ç”¨æ–¹æ³•

å¯ä»¥åœ¨æŸä¸ªchainä¸­ä½¿ç”¨`extends`å±æ€§æ¥æŒ‡æ˜è¯¥chainç»§æ‰¿è‡ªå“ªä¸ªchainã€‚åœ¨è¢«ç»§æ‰¿çš„chainä¸­ï¼Œéœ€è¦é¢„ç•™å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå ä½ç¬¦ï¼Œä»¥ä¾¿äºå­chainå¯ä»¥å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼›è€Œåœ¨å­chainä¸­ï¼Œéœ€è¦å¯¹è¢«ç»§æ‰¿çš„çˆ¶chainä¸­çš„æ‰€æœ‰å ä½ç¬¦è¿›è¡Œå®ç°ã€‚

å­chainä¸­çš„å®ç°å¯ä»¥æ˜¯ç»„ä»¶ï¼Œå¯ä»¥æ˜¯è¡¨è¾¾å¼ï¼Œå¯ä»¥æ˜¯å…¶ä»–chainçš„idã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ€ç»ˆå®ç°çš„chainå¿…é¡»æ˜¯ä¸€ä¸ªåˆæ³•çš„ELè§„åˆ™ï¼Œå¦åˆ™ä¼šè§£æå¤±è´¥ã€‚å­chainçš„å®ç°ä¸­åŒæ ·å¯ä»¥åŒ…å«å ä½ç¬¦ï¼Œä»è€Œå®ç°å¤šçº§ç»§æ‰¿ã€‚

### [#](https://liteflow.cc/pages/524c43/#ä¾‹å­)ä¾‹å­

ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­:

```xml
<chain id="base">
    THEN(a, b, {0}, {1});
</chain>

<chain id="implA" extends="base">
    {0}=IF(c, d, e);
    {1}=SWITCH(f).to(j,k);
</chain>
```

é€šè¿‡ä¸Šè¿°å®šä¹‰ï¼Œå®ç°äº†ä¸€ä¸ªç»§æ‰¿è‡ªbaseçš„implA,æœ€ç»ˆå®ç°çš„implAæµç¨‹å¦‚ä¸‹

```xml
<chain id="implA">
    THEN(a, b, IF(c, d, e), SWITCH(f).to(j,k));
</chain>
```

ä¸‹é¢æ˜¯ä¸€ä¸ªå¤šçº§ç»§æ‰¿çš„ä¾‹å­:

```xml
    <chain id="base">
        THEN(a, b, {0}, {1});
    </chain>

    <chain id="base2" extends="base">
        {0}=THEN(a,b,{3});
        {1}=SWITCH(f).to({4},k);
    </chain>

    <chain id="implB" extends="base2">
        {3}=THEN(a,b);
        {4}=j;
    </chain>
```

åœ¨ä¸Šé¢çš„å®šä¹‰ä¸­,implBç»§æ‰¿è‡ªbase2,base2åˆç»§æ‰¿è‡ªbase,æœ€ç»ˆå®ç°çš„implBæµç¨‹å¦‚ä¸‹ï¼š

```xml
    <chain id="implB" extends="base2">
        THEN(
            a, b,
            THEN(a, b,
                THEN(a,b)
            ),
            SWITCH(f).to(j,k) 
        );
    </chain>
```

com.yomahub.liteflow.parser.helper.ParserHelperæ˜¯ä¸€ä¸ªå¾ˆå¥½ç©çš„ç±»

è§£æchainæ–‡æ¡£

```java
public static void parseChainDocument(List<Document> documentList, Set<String> chainNameSet,
			Consumer<Element> parseOneChainConsumer) {
		//ç”¨äºå­˜æ”¾æŠ½è±¡chainçš„map
		Map<String,Element> abstratChainMap = new HashMap<>();
		//ç”¨äºå­˜æ”¾å·²ç»è§£æè¿‡çš„å®ç°chain
		Set<Element> implChainSet = new HashSet<>();
		// å…ˆåœ¨å…ƒæ•°æ®é‡Œæ”¾ä¸Šchain
		// å…ˆæ”¾æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå¯ä»¥åœ¨parseçš„æ—¶å€™å…ˆæ˜ å°„åˆ°FlowBusçš„chainMapï¼Œç„¶åå†å»è§£æ
		// è¿™æ ·å°±ä¸ç”¨å»åƒä¹‹å‰çš„ç‰ˆæœ¬é‚£æ ·å›å½’è°ƒç”¨
		// åŒæ—¶ä¹Ÿè§£å†³äº†ä¸èƒ½å¾ªç¯ä¾èµ–çš„é—®é¢˜
		documentList.forEach(document -> {
			// è§£æchainèŠ‚ç‚¹
			List<Element> chainList = document.getRootElement().elements(CHAIN);

			// å…ˆåœ¨å…ƒæ•°æ®é‡Œæ”¾ä¸Šchain
			chainList.forEach(e -> {
				// æ ¡éªŒåŠ è½½çš„ chainName æ˜¯å¦æœ‰é‡å¤çš„
				// TODO è¿™é‡Œæ˜¯å¦æœ‰ä¸ªé—®é¢˜ï¼Œå½“æ··åˆæ ¼å¼åŠ è½½çš„æ—¶å€™ï¼Œ2ä¸ªåŒåçš„Chainåœ¨ä¸åŒçš„æ–‡ä»¶é‡Œï¼Œå°±ä¸è¡Œäº†
				String chainName = Optional.ofNullable(e.attributeValue(ID)).orElse(e.attributeValue(NAME));
				// æ£€æŸ¥ chainName
				checkChainId(chainName, e.getText());
				if (!chainNameSet.add(chainName)) {
					throw new ChainDuplicateException(StrUtil.format("[chain name duplicate] chainName={}", chainName));
				}

				FlowBus.addChain(chainName);
				if(RegexUtil.isAbstractChain(e.getText())){
					abstratChainMap.put(chainName,e);
					//å¦‚æœæ˜¯æŠ½è±¡chainï¼Œåˆ™å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªAbstractCondition,ç”¨äºæ ‡è®°è¿™ä¸ªchainä¸ºæŠ½è±¡chain
					Chain chain = FlowBus.getChain(chainName);
					chain.getConditionList().add(new AbstractCondition());
				}
			});
		});
		// æ¸…ç©º
		chainNameSet.clear();

		// è§£ææ¯ä¸€ä¸ªchain
		for (Document document : documentList) {
			Element rootElement = document.getRootElement();
			List<Element> chainList = rootElement.elements(CHAIN);
			for(Element chain:chainList){
				//é¦–å…ˆéœ€è¦å¯¹ç»§æ‰¿è‡ªæŠ½è±¡Chainçš„chainè¿›è¡Œå­—ç¬¦ä¸²æ›¿æ¢
				parseImplChain(abstratChainMap, implChainSet, chain);
				//å¦‚æœä¸€ä¸ªchainä¸ä¸ºæŠ½è±¡chainï¼Œåˆ™è¿›è¡Œè§£æ
				String chainName = Optional.ofNullable(chain.attributeValue(ID)).orElse(chain.attributeValue(NAME));
				if(!abstratChainMap.containsKey(chainName)){
					parseOneChainConsumer.accept(chain);
				}
			}
		}
	}
```

***è§£æä¸€ä¸ªå¸¦ç»§æ‰¿å…³ç³»çš„Chain,xmlæ ¼å¼***

```java
private static void parseImplChain(Map<String, Element> abstratChainMap, Set<Element> implChainSet, Element chain) {
		if(ObjectUtil.isNotNull(chain.attributeValue(EXTENDS))){
			String baseChainId = chain.attributeValue(EXTENDS);
			Element baseChain = abstratChainMap.get(baseChainId);
			if(baseChain!=null) {
				internalParseImplChain(baseChain,chain,abstratChainMap,implChainSet);
			}else{
				throw new ChainNotFoundException(StrUtil.format("[abstract chain not found] chainName={}", baseChainId));
			}
		}
	}
```

***è§£æä¸€ä¸ªç»§æ‰¿è‡ªbaseChainçš„implChain,jsonæ ¼å¼***

```java
private static void internalParseImplChain(Element baseChain,Element implChain,Map<String,Element> abstractChainMap,Set<Element> implChainSet) {
		//å¦‚æœå·²ç»è§£æè¿‡äº†ï¼Œå°±ä¸å†è§£æ
		if(implChainSet.contains(implChain)) return;
		//å¦‚æœbaseChainIdä¹Ÿæ˜¯ç»§æ‰¿è‡ªå…¶ä»–çš„chainï¼Œéœ€è¦é€’å½’è§£æ
		parseImplChain(abstractChainMap, implChainSet, baseChain);
		//å¦åˆ™æ ¹æ®baseChainIdè§£æimplChainId
		String implChainEl = implChain.getText();
		String baseChainEl = baseChain.getText();
		//æ›¿æ¢baseChainIdä¸­çš„implChainId
		// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å ä½ç¬¦å¹¶æ›¿æ¢
		String parsedEl = RegexUtil.replaceAbstractChain(baseChainEl,implChainEl);
		implChain.setText(parsedEl);
		implChainSet.add(implChain);
	}
```



### [#](https://liteflow.cc/pages/524c43/#æ³¨æ„äº‹é¡¹)æ³¨æ„äº‹é¡¹

1. åœ¨ç»§æ‰¿chainå’Œè¢«ç»§æ‰¿chainä¸­éœ€è¦ä½¿ç”¨å½¢å¦‚{x}çš„å ä½ç¬¦ï¼Œå…¶ä¸­xå¯ä»¥æ˜¯ä»¥ä¸‹ä¸¤ç§å½¢å¼ä¹‹ä¸€ï¼š

   - çº¯æ•°å­—æ„æˆ
   - ç”±å­—æ¯ã€ä¸‹åˆ’çº¿ä»¥åŠæ•°å­—æ„æˆï¼Œä½†æ˜¯æ•°å­—ä¸èƒ½ä½œä¸ºå¼€å¤´

   ä¹Ÿå°±æ˜¯è¯´ï¼Œå½¢å¦‚{1}ã€{a}ã€{a1}ã€{a_1}éƒ½æ˜¯åˆæ³•çš„å ä½ç¬¦ï¼Œè€Œ{1a}ã€{1_a}éƒ½æ˜¯éæ³•çš„å ä½ç¬¦ã€‚

2. è¯·ä¿è¯è¢«ç»§æ‰¿chainä¸­è‡³å°‘æœ‰ä¸€ä¸ªå ä½ç¬¦ï¼Œä¸”åœ¨è¢«ç»§æ‰¿chainä¸­å®šä¹‰çš„æ‰€æœ‰å ä½ç¬¦ï¼Œéƒ½å¿…é¡»è¦åœ¨å­chainä¸­è¿›è¡Œå®ç°ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

3. å¦‚æœä¸€ä¸ªchainä¸­åŒ…å«æœªè¢«å®ç°çš„å ä½ç¬¦ï¼Œé‚£ä¹ˆæ‰§è¡Œè¯¥chainä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œå°è¯•æ‰§è¡Œä¸Šæ–‡æ‰€è¿°çš„base,base2éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºå®ƒä»¬åˆ†åˆ«åŒ…å«æœªè¢«å®ç°çš„å ä½ç¬¦{0},{1}å’Œ{3},{4}ã€‚

4. å¦‚æœåœ¨å­chainä¸­å®šä¹‰äº†é™¤å ä½ç¬¦å®ç°ä»¥å¤–çš„å…¶ä»–è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆè¯¥è¡¨è¾¾å¼å°†è¢«å¿½ç•¥ã€‚ä¸¾ä¸ªä¾‹å­,å¦‚æœimplAè¿™æ ·å®ç°ï¼š

   ```xml
   <chain id="implA" extends="base">
       {0}=IF(c, d, e);
       {1}=SWITCH(f).to(j,k);
       THEN(a,b);
   </chain>
   ```

   é‚£ä¹ˆå…¶ä¸­çš„`THEN(a,b);`å°†ä¼šè¢«å¿½ç•¥ã€‚

# ğŸ–å¹³æ»‘çƒ­åˆ·æ–°

LiteFlowæ”¯æŒäº†ä¼˜é›…å¹³æ»‘çƒ­åˆ·æ–°çš„ç‰¹æ€§ã€‚

å³ä½ å¯ä»¥åœ¨ä¸é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œè§„åˆ™çš„é‡è½½ã€‚å¹¶ä¸”åœ¨é«˜å¹¶å‘ä¸‹åˆ·æ–°çš„æ—¶å€™ï¼Œæ­£åœ¨æ‰§è¡Œæµç¨‹çš„çº¿ç¨‹æ˜¯å®Œå…¨å¹³æ»‘çš„ï¼Œä¸ä¼šå› ä¸ºåˆ·æ–°çš„è¿‡ç¨‹è€Œå‡ºç°ä¸­æ–­çš„ç°è±¡ã€‚

åœ¨åˆ·æ–°æ—¶ï¼Œæ­£åœ¨æ‰§è¡Œçš„æµç¨‹è¿˜æ˜¯èµ°çš„æ—§çš„æµç¨‹ï¼Œåˆ·æ–°å¥½ã€‚åç»­requestä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æ–°çš„æµç¨‹ã€‚



## [#](https://liteflow.yomahub.com/pages/204d71/#è‡ªåŠ¨åˆ·æ–°çš„åœºæ™¯)è‡ªåŠ¨åˆ·æ–°çš„åœºæ™¯

å¦‚æœä½ ä½¿ç”¨LiteFlowåŸç”Ÿæ”¯æŒçš„zookeeperï¼Œetcdï¼Œnacosï¼Œapolloç­‰æ’ä»¶ï¼ˆå…³äºå¦‚ä½•é›†æˆæ’ä»¶ï¼Œè¯·å‚è€ƒ`è§„åˆ™æ–‡ä»¶`è¿™ä¸€å¤§ç« èŠ‚ï¼‰ï¼Œä¸éœ€è¦ä½ åšä»»ä½•äº‹ï¼Œåªè¦è§„åˆ™æ›´æ”¹ä¹‹åï¼Œä¼šè‡ªåŠ¨çƒ­å¹³æ»‘åˆ·æ–°ã€‚



å¦‚æœä½ æ˜¯åŸºäºæœ¬åœ°ç£ç›˜è§„åˆ™æ–‡ä»¶çš„ï¼Œå¹¶ä¸”å¼€å¯äº†è‡ªåŠ¨ç›‘å¬è®¾ç½®ï¼Œé‚£ä¹ˆæ›´æ”¹æµç¨‹åä¹Ÿä¼šè‡ªåŠ¨å¹³æ»‘åˆ·æ–°ã€‚å…³äºå¦‚ä½•å¼€å¯è‡ªåŠ¨ç›‘å¬ï¼Œè¯·å‚è€ƒ[æœ¬åœ°è§„åˆ™æ–‡ä»¶ç›‘å¬](https://liteflow.yomahub.com/pages/f8aa79/)è¿™ä¸€ç« ã€‚

## [#](https://liteflow.yomahub.com/pages/204d71/#ä¸»åŠ¨è°ƒç”¨ä»£ç åˆ·æ–°)ä¸»åŠ¨è°ƒç”¨ä»£ç åˆ·æ–°

å¦‚æœä½ ä½¿ç”¨äº†æ•°æ®åº“ä½œä¸ºè§„åˆ™æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼ï¼Œæˆ–æ˜¯ä½ è‡ªå·±å®ç°äº†è‡ªå®šä¹‰é…ç½®æºï¼Œé‚£ä¹ˆLiteFlowè¿˜æä¾›äº†ä¸€ç§åŸºäºä»£ç åˆ·æ–°çš„æ–¹å¼ã€‚



ä½ å¯ä»¥åœ¨springå®¹å™¨ä¸­æ‹¿åˆ°`FlowExecutor`å¯¹è±¡åï¼Œè°ƒç”¨ä»¥ä¸‹æ¥å£ï¼š

```java
flowExecutor.reloadRule();
```

è¿™ä¸ªæ–¹æ³•ä¼šæŒ‰ç…§å¯åŠ¨æ—¶çš„æ–¹å¼å»æ‹‰å–ä½ æœ€æ–°çš„æµç¨‹é…ç½®ä¿¡æ¯ï¼Œè¿›è¡Œå¹³æ»‘çƒ­åˆ·æ–°ã€‚



è¿™æ ·è°ƒç”¨æœ‰ä»¥ä¸‹2ç‚¹æ³¨æ„äº‹é¡¹ï¼š

æç¤º

1.è¿™æ ·åˆ·æ–°æ˜¯å…¨é‡åˆ·æ–°ï¼Œä¸è¿‡å„ä½åŒå­¦ä¸ç”¨æ‹…å¿ƒå…¶æ€§èƒ½ï¼Œç»æµ‹è¯•ï¼ŒLiteFlowæ¡†æ¶ä¸€ç§’å¯ä»¥åˆ·æ–°1000æ¡è§„åˆ™å·¦å³ï¼Œè¿™éƒ½æ˜¯ä¸€äº›cpuçº§åˆ«çš„æ“ä½œï¼Œå¦‚æœä½ è§„åˆ™æ²¡æœ‰ä¸Šå¤§å‡ åƒï¼Œå‡ wæ¡ï¼Œé‚£ä¹ˆæ¨èè¿™ç§æ–¹å¼ã€‚

2.å¦‚æœä½ çš„åº”ç”¨æ˜¯å¤šèŠ‚ç‚¹éƒ¨ç½²çš„ï¼Œå¿…é¡»åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¦åˆ·æ–°ï¼Œå› ä¸ºè§„åˆ™æ˜¯å­˜å‚¨åœ¨jvmå†…å­˜é‡Œçš„ã€‚è¿™å°±æ„å‘³ç€ï¼Œå¦‚æœä½ æŠŠåˆ·æ–°è§„åˆ™åšæˆä¸€ä¸ªrpcæ¥å£ï¼ˆè¯¸å¦‚dubboæ¥å£ä¹‹ç±»çš„ï¼‰ï¼Œé‚£ä¹ˆrpcæ¥å£åªä¼šè°ƒç”¨åˆ°å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªä¼šæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„è§„åˆ™ä¼šåˆ·æ–°ã€‚

æ­£ç¡®çš„åšæ³•æ˜¯ï¼šåˆ©ç”¨mqå‘ä¸€ä¸ªæ¶ˆæ¯ï¼Œè®©å„ä¸ªèŠ‚ç‚¹å»ç›‘å¬åˆ°ï¼Œè¿›è¡Œåˆ·æ–°ã€‚



## [#](https://liteflow.yomahub.com/pages/204d71/#å•ç‹¬åˆ·æ–°æŸä¸€ä¸ªè§„åˆ™)å•ç‹¬åˆ·æ–°æŸä¸€ä¸ªè§„åˆ™

å¦‚æœä½ çš„è§„åˆ™æ¯”è¾ƒå¤šï¼Œæˆåƒä¸Šä¸‡æ¡ï¼Œåˆæˆ–è€…ä½ å°±æ˜¯ä¸æƒ³å…¨é‡åˆ·æ–°ã€‚å¸Œæœ›å•ç‹¬åˆ·æ–°æŸä¸ªæ”¹åŠ¨çš„è§„åˆ™ã€‚

é‚£ä¹ˆLiteFlowä¹Ÿæä¾›äº†ç›¸åº”çš„æ–¹å¼ã€‚

ä½ å¯ä»¥åˆ©ç”¨ä»¥ä¸‹apiæ¥è¿›è¡Œåˆ·æ–°ï¼š

```java
LiteFlowChainELBuilder.createChain().setChainName("chain2").setEL(
  "THEN(a, b, WHEN(c, d))"
).build();
```

æç¤º

æ—¢ç„¶æ˜¯æŒ‡å®šåˆ·æ–°ï¼Œé‚£ä¹ˆå¿…é¡»ä½ è¦è·å–åˆ°æ”¹åŠ¨çš„ELå†…å®¹ï¼Œç„¶åå†åˆ©ç”¨åŠ¨æ€ä»£ç æ„å»ºé‡æ–°buildä¸‹å°±å¯ä»¥äº†ï¼Œè¿™ç§æ–¹å¼ä¼šè‡ªåŠ¨æ›¿æ¢ç¼“å­˜ä¸­å·²æœ‰çš„è§„åˆ™ã€‚è¿™ç§æ–¹å¼ä¸ç”¨åœ¨buildä¹‹å‰é”€æ¯æµç¨‹ã€‚

å¦‚æœæ˜¯å¤šæœåŠ¡èŠ‚ç‚¹éƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯è¦éµå¾ªæ¯ä¸ªèŠ‚ç‚¹è¦éƒ½åˆ·æ–°ï¼Œä¸Šé¢å·²ç»è¯´æ˜å…·ä½“å»ºè®®çš„æ–¹å¼ã€‚è¿™é‡Œä¸å†èµ˜è¿°ã€‚

# ğŸªç»„ä»¶åˆ‡é¢

LiteFlowä»2.5.0ç‰ˆæœ¬å¼€å§‹ï¼Œå¼€å§‹æ”¯æŒç»„ä»¶çš„åˆ‡é¢åŠŸèƒ½ï¼Œä½ å¯ä»¥é€šè¿‡2ç§æ–¹å¼è¿›è¡Œ

## [#](https://liteflow.yomahub.com/pages/2373f5/#å…¨å±€åˆ‡é¢)å…¨å±€åˆ‡é¢

å…¨å±€åˆ‡é¢æ˜¯é’ˆå¯¹äºæ‰€æœ‰çš„ç»„ä»¶ï¼Œè¿›è¡Œåˆ‡é¢ã€‚ä½ åªéœ€è¦åšå¦‚ä¸‹å®ç°å³å¯ï¼š

```java
@Component
public class CmpAspect implements ICmpAroundAspect {
    @Override
    public void beforeProcess(NodeComponent cmp) {
        YourContextBean context = cmp.getContextBean(YourContextBean.class);
        //before business
    }

    @Override
    public void afterProcess(NodeComponent cmp) {
        YourContextBean context = cmp.getContextBean(YourContextBean.class);
        //after business
    }
}
```

## [#](https://liteflow.yomahub.com/pages/2373f5/#aspectçš„åˆ‡é¢)Aspectçš„åˆ‡é¢

LiteFlowåŒæ—¶ä¹Ÿæ”¯æŒäº†Spring Aspectçš„åˆ‡é¢ï¼Œä½ å¯ä»¥ç”¨@Aspectæ ‡æ³¨å¯¹ä»»æ„åŒ…ï¼Œä»»æ„è§„åˆ™å†…çš„ç»„ä»¶è¿›è¡Œåˆ‡é¢

```java
@Aspect
public class CustomAspect {

    @Pointcut("execution(* com.yomahub.liteflow.test.aop.cmp1.*.process())")
    public void cut() {
    }

    @Around("cut()")
    public Object around(ProceedingJoinPoint jp) throws Throwable {
        //do before business
        Object returnObj = jp.proceed();
        //do after business
        return returnObj;
    }
}
```

# ğŸ¡æ­¥éª¤ä¿¡æ¯

LiteFlowä¸ºæ‰§è¡Œçš„è¿‡ç¨‹æä¾›äº†è¯¦ç»†çš„æ­¥éª¤ä¿¡æ¯ã€‚

è·å–ä¸€æ¡æµç¨‹æ‰§è¡Œçš„æ­¥éª¤ä¿¡æ¯æ˜¯é€šè¿‡`LiteflowResponse`å¯¹è±¡æ¥è·å–çš„ï¼š

```java
LiteflowResponse response = flowExecutor.execute2Resp("chain1", "åˆå§‹å‚æ•°", CustomContext.class);
Map<String, CmpStep> stepMap = response.getExecuteSteps();
//æˆ–è€…ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹çš„è¯­å¥æ¥è·å¾—ä¸€ä¸ªæ­¥éª¤é˜Ÿåˆ—
Queue<CmpStep> stepQueue = response.getExecuteStepQueue();
```

ä»¥ä¸Šè¿™2ä¸ªæ–¹æ³•çš„åŒºåˆ«æ˜¯ï¼š

æç¤º

è·å¾—`Map`è¿”å›å€¼çš„é‚£ä¸ªæ–¹æ³•ï¼Œå¦‚æœæœ‰å¤šä¸ªç›¸åŒçš„ç»„ä»¶ï¼Œé‚£ä¹ˆä»¥ä¸Šè¿™ä¸ªæ–¹æ³•è·å¾—çš„`Map`ä¸­è¿™ä¸ªç»„ä»¶idçš„valueæ˜¯æœ€ç»ˆçš„é‚£ä¸ªæ­¥éª¤ä¿¡æ¯ã€‚

è€Œè·å¾—`Queue<CmpStep>`è¿™ä¸ªè¿”å›å€¼çš„æ–¹æ³•ï¼Œè¿”å›å€¼é‡ŒåŒ…å«äº†æ‰€æœ‰çš„æ­¥éª¤ä¿¡æ¯ï¼Œç›¸åŒçš„ç»„ä»¶åœ¨è§„åˆ™é‡Œå®šä¹‰næ¬¡ï¼Œé‚£ä¹ˆè¿™é‡Œä¹Ÿæœ‰nä¸ªæ­¥éª¤ã€‚

åœ¨`CmpStep`è¿™ä¸ªå¯¹è±¡é‡Œï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è·å¾—ä½ è¦çš„æ•°æ®ï¼š

- `isSuccess`ï¼šæ­¤ç»„ä»¶æ˜¯å¦æ‰§è¡ŒæˆåŠŸ
- `getNodeId`ï¼šè·å¾—ç»„ä»¶Id
- `getNodeName`ï¼šè·å¾—ç»„ä»¶åç§°
- `getTag`ï¼šè·å¾—ç»„ä»¶æ ‡ç­¾å€¼
- `getTimeSpent`ï¼šè·å¾—ç»„ä»¶çš„è€—æ—¶ï¼Œå•ä½ä¸ºæ¯«ç§’
- `getException`ï¼šè·å–æ­¤ç»„ä»¶æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¦‚æœisSuccessä¸ºfalseçš„è¯ã€‚ä½†æ˜¯è¿™é‡Œè¦æ³¨æ„ä¸‹ï¼šæœ‰exceptionï¼Œsuccessä¸€å®šä¸ºfalseï¼Œä½†æ˜¯successä¸ºfalseï¼Œä¸ä¸€å®šæœ‰exceptionï¼Œå› ä¸ºæœ‰å¯èƒ½æ²¡æ‰§è¡Œåˆ°ï¼Œæˆ–è€…æ²¡æ‰§è¡Œç»“æŸ(anyçš„æƒ…å†µ)ã€‚

æç¤º

å¦‚æœä½ çš„æŸä¸€ä¸ªç»„ä»¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œåœ¨é»˜è®¤é…ç½®æƒ…å†µä¸‹ï¼Œæµç¨‹ä¼šä¸­æ–­ã€‚é‚£ä¹ˆ`response.getCause()`å’Œç›¸åº”ç»„ä»¶æ­¥éª¤é‡Œçš„exceptionéƒ½æ˜¯ä¸€è‡´çš„ã€‚ä¸”æ²¡æ‰§è¡Œçš„ç»„ä»¶ä¸ä¼šæœ‰ç›¸åº”æ­¥éª¤ä¿¡æ¯ã€‚

# ğŸ§Šå¼‚å¸¸

é€šå¸¸åœ¨LiteFlowç»„ä»¶é‡Œå¦‚æœå¾€å¤–æŠ›å‡ºå¼‚å¸¸ï¼Œæµç¨‹ä¼šä¸­æ–­ã€‚é™¤äº†åœ¨[å¹¶è¡Œç¼–æ’](https://liteflow.yomahub.com/pages/b3446a/)ä¸­è®¾ç½®`ignoreError`å…³é”®å­—ä»¥å¤–ã€‚

å¾€å¤–æŠ›å‡ºçš„å¼‚å¸¸ä¼šè¢«æœ€å¤–å±‚çš„æ‰§è¡Œå™¨æ•è·ï¼Œå¹¶è¢«åŒ…è£…è¿›`LiteflowResponse`å¯¹è±¡ä¸­ã€‚

ä½ å¯ä»¥åœ¨`LiteflowResponse`å¯¹è±¡ä¸­é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥è·å–å¼‚å¸¸

```java
LiteflowResponse response = flowExecutor.execute2Resp("chain1", åˆå§‹å‚æ•°, CustomContext.class);
if (!response.isSuccess()){
  Exception e = response.getCause();
}
```

å¦‚æœä½ çš„ä¸šåŠ¡ä¸­æœ‰è·å–å¼‚å¸¸Codeçš„éœ€æ±‚ï¼Œåˆ™ä½ è‡ªå®šä¹‰çš„å¼‚å¸¸éœ€è¦å®ç°LiteFlowæä¾›çš„`LiteFlowException`æ¥å£ï¼š

```java
public class YourException extends LiteFlowException {
	public YourException(String code, String message) {
		super(code, message);
	}
}
```

å¦‚æœä½ çš„ä¸šåŠ¡æŠ›å‡ºäº†å®ç°äº†`LiteFlowException`æ¥å£çš„å¼‚å¸¸ï¼Œä½ åˆ™å¯ä»¥åœ¨`LiteflowResponse`ä¸­è·å¾—messageå’Œcodeä¿¡æ¯ï¼š

```java
LiteflowResponse response = flowExecutor.execute2Resp("chain1", åˆå§‹å‚æ•°, CustomContext.class);
if (!response.isSuccess()){
  Exception e = response.getCause();
  String code = response.getCode();
  String message = response.getMessage();
}
```

æç¤º

å¦‚æœä½ çš„å¼‚å¸¸æ²¡å®ç°`LiteFlowException`ï¼Œcodeå’Œmessageå­—æ®µéƒ½ä¸ºnullã€‚

# ğŸ§‡æ‰“å°ä¿¡æ¯è¯¦è§£

## [#](https://liteflow.yomahub.com/pages/4d614c/#æµç¨‹æ‰§è¡Œä¸­æ‰“å°)æµç¨‹æ‰§è¡Œä¸­æ‰“å°

åœ¨æ‰§è¡Œä¸€æ¡æµç¨‹æ—¶ï¼Œä½ åœ¨æ—¥å¿—ä¸­ä¼šçœ‹åˆ°è¯¸å¦‚ä»¥ä¸‹çš„æ—¥å¿—ï¼š

```text
[ea1af4810cc849d58948d091d858b29a]:[O]start component[ACmp] execution
[ea1af4810cc849d58948d091d858b29a]:[O]start component[BCmp] execution
[ea1af4810cc849d58948d091d858b29a]:[X]start component[CCmp] execution
[ea1af4810cc849d58948d091d858b29a]:[O]start component[DCmp] execution
```

å…¶ä¸­æœ€å‰é¢çš„ä¸€ä¸²åºå·ï¼Œä»£è¡¨è¿™ä¸ªè¯·æ±‚çš„è¯·æ±‚IDï¼Œä¸€ä¸ªè¯·æ±‚æ— è®ºç»å†äº†å¤šå°‘ä¸ªç»„ä»¶ï¼Œä»–ä»¬çš„è¯·æ±‚IDéƒ½æ˜¯ä¸€è‡´çš„ï¼Œä½ å¯ä»¥æ ¹æ®è¿™ä¸ªIDåœ¨æ—¥å¿—ä¸­è¿›è¡Œå¿«é€Ÿå®šä½è¿›è¡Œæ’æŸ¥ã€‚

åœ¨åé¢ä¼šè·Ÿç€ä¸€ä¸ª[O]æˆ–è€…[X]ï¼Œ[O]ä»£è¡¨äº†æ‰§è¡Œäº†è¿™ä¸ªç»„ä»¶çš„ä¸»è¦é€»è¾‘ï¼Œ[X]ä»£è¡¨å› ä¸º`isAccess()`è¿”å›äº†falseæ‰€ä»¥æ²¡è¿›å…¥è¿™ä¸ªç»„ä»¶çš„ä¸»è¦é€»è¾‘ã€‚

å¦‚æœä½ ä¸å¸Œæœ›æ‰“å°è¿™ç§ä¸­é—´æ‰§è¡Œä¿¡æ¯ï¼ŒLiteFlowæä¾›äº†é…ç½®é¡¹ï¼Œä½ éœ€è¦ä½œå¦‚ä¸‹è®¾ç½®ï¼š

```properties
liteflow.print-execution-log=false
```

## [#](https://liteflow.yomahub.com/pages/4d614c/#æ‰“å°æ­¥éª¤ä¿¡æ¯)æ‰“å°æ­¥éª¤ä¿¡æ¯

åœ¨æ‰§è¡Œå®Œä¸€ä¸ªé“¾è·¯ä¹‹åï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨æ‰“å‡ºè¿™ä¸€æ¡æµç¨‹çš„æ‰§è¡Œæ­¥éª¤é¡ºåºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```text
a<100>==>c<10>==>m<0>==>q<200>==>p<300>==>p1<0>==>g<305>
```

è¿™é‡Œçš„è¡¨è¾¾å½¢å¼ä¸ºï¼š`ç»„ä»¶ID<è€—æ—¶æ¯«ç§’>`

å¦‚æœä½ å¸Œæœ›åœ¨æ‰“å°æµç¨‹é“¾çš„æ—¶å€™å¢åŠ åˆ«åæè¿°ï¼Œé‚£ä½ éœ€è¦åœ¨å®šä¹‰ç»„ä»¶çš„æ—¶å€™è®¾ç½®nameå±æ€§ï¼Œå…·ä½“è¯·å‚ç…§[ç»„ä»¶åˆ«å](https://liteflow.yomahub.com/pages/92ef89/)ã€‚

å¢åŠ äº†åˆ«åä¹‹åï¼Œæ‰§è¡Œæ­¥éª¤ä¿¡æ¯çš„æ‰“å°ä¼šå˜æˆä»¥ä¸‹æ ·å­ï¼š

```text
a[ç»„ä»¶A]<100>==>b[ç»„ä»¶B]<0>==>m[ç»„ä»¶M]<256>
```

è¿™é‡Œçš„è¡¨è¾¾å½¢å¼ä¸ºï¼š`ç»„ä»¶ID[ç»„ä»¶åˆ«å]<è€—æ—¶æ¯«ç§’>`

# ğŸ§è‡ªå®šä¹‰è¯·æ±‚Id

LiteFlowæ”¯æŒè®©ä½ è‡ªå®šä¹‰ä½ çš„è¯·æ±‚Idã€‚

å¤§å®¶åœ¨æ‰§è¡Œä¸€æ¡æµç¨‹çš„æ—¶å€™ï¼Œå¾€å¾€å¯ä»¥åœ¨æ—¥å¿—ä¿¡æ¯ä¸­çœ‹åˆ°ä»¥ä¸‹ç±»ä¼¼çš„ä¿¡æ¯ï¼š

```text
2022-07-03 11:15:00.196  INFO 71275 --- [           main] com.yomahub.liteflow.flow.element.Node   : [067a0baa6d434de3a8ccafa4b1506562]:[O]start component[a] execution
2022-07-03 11:15:00.204  INFO 71275 --- [           main] com.yomahub.liteflow.flow.element.Node   : [067a0baa6d434de3a8ccafa4b1506562]:[O]start component[b] execution
2022-07-03 11:15:00.218  INFO 71275 --- [lf-when-thead-0] com.yomahub.liteflow.flow.element.Node   : [067a0baa6d434de3a8ccafa4b1506562]:[O]start component[c] execution
2022-07-03 11:15:00.220  INFO 71275 --- [lf-when-thead-1] com.yomahub.liteflow.flow.element.Node   : [067a0baa6d434de3a8ccafa4b1506562]:[O]start component[d] execution
2022-07-03 11:15:00.220  INFO 71275 --- [           main] com.yomahub.liteflow.slot.Slot           : [067a0baa6d434de3a8ccafa4b1506562]:CHAIN_NAME[chain1]
a<1>==>b<0>==>c<0>==>d<0>
2022-07-03 11:15:00.221  INFO 71275 --- [           main] com.yomahub.liteflow.slot.DataBus        : [067a0baa6d434de3a8ccafa4b1506562]:slot[0] released
```

å…¶ä¸­æ—¥å¿—ä¸»ä½“ä¸­æœ€å‰é¢çš„å°±æ˜¯RequestIdï¼Œä¸€ä¸ªè¯·æ±‚ä¸­çš„requestIdéƒ½æ˜¯ç›¸åŒçš„ï¼Œæ–¹ä¾¿ä½ è¿›è¡Œæ—¥å¿—æŸ¥æ‰¾ã€‚

è¿™ä¸ªrequestIdçš„å½¢å¼ä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ã€‚ä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„è§„åˆ™ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥ä¼ å…¥æœ¬æ¥å·²æœ‰çš„TraceIdæ¥å’Œç³»ç»Ÿåšé›†æˆã€‚

## [#](https://liteflow.yomahub.com/pages/47e8f5/#æŒ‰ç…§è‡ªå·±çš„è§„åˆ™ç”Ÿæˆ)æŒ‰ç…§è‡ªå·±çš„è§„åˆ™ç”Ÿæˆ

ä½ åªéœ€è¦è¦å£°æ˜ä¸€ä¸ªç±»ï¼Œç„¶åå®ç°`RequestIdGenerator`æ¥å£å³å¯ï¼š

```java
public class CustomRequestIdGenerator implements RequestIdGenerator {

    @Override
    public String generate() {
        return System.nanoTime();
    }
}
```

ç„¶ååœ¨LiteFlowçš„é…ç½®æ–‡ä»¶é‡Œå£°æ˜ä¸‹ä½ è¿™ä¸ªç±»å³å¯ï¼š

```properties
liteflow.request-id-generator-class=com.yomahub.liteflow.test.requestId.config.CustomRequestIdGenerator
```

ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒLiteFlowæœ‰è‡ªå·±é»˜è®¤çš„Idç”Ÿæˆè§„åˆ™ã€‚æ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ä½ å¹¶ä¸éœ€è¦å»ç‰¹åˆ«è‡ªå®šä¹‰è¿™ä¸ªIdç”Ÿæˆå™¨ã€‚

## [#](https://liteflow.yomahub.com/pages/47e8f5/#ä¼ å…¥å·²æœ‰çš„requestid-traceid)ä¼ å…¥å·²æœ‰çš„requestId/traceId

LiteFlowåœ¨v2.10.5ç‰ˆæœ¬ä¸­å¯¹äºè¿™ä¸ªç‰¹æ€§ç»™äºˆäº†æ”¯æŒã€‚åœ¨FlowExecutorè¿›è¡Œè°ƒç”¨çš„æ—¶å€™ï¼Œä½ å¯ä»¥è°ƒç”¨å¦‚ä¸‹æ–¹æ³•æ¥ä¼ å…¥ä¸€ä¸ªå·²æœ‰çš„requestIdï¼š

```java
LiteflowResponse response = flowExecutor.execute2RespWithRid("chain1", arg, "T001234", YourContext.class);
```

é‚£ä¹ˆï¼Œè¿™ä¸ªé“¾è·¯ä¸­æ‰€æœ‰çš„æ¡†æ¶æ—¥å¿—å‰ï¼Œéƒ½ä¼šå¸¦æœ‰[T001234]è¿™ä¸ªä¼ å…¥çš„IDäº†ã€‚

## [#](https://liteflow.yomahub.com/pages/47e8f5/#ç»™ç»„ä»¶ä¸­çš„æ—¥å¿—ä¹ŸåŠ ä¸Šè¯·æ±‚idå‰ç¼€)ç»™ç»„ä»¶ä¸­çš„æ—¥å¿—ä¹ŸåŠ ä¸Šè¯·æ±‚IDå‰ç¼€

å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒLiteFlowè¿˜æä¾›äº†ä¸€ä¸ªæ—¥å¿—åŒ…è£…ç±»ã€‚åªè¦ä½ åœ¨ç»„ä»¶ä¸­æŠŠslf4jçš„æ—¥å¿—å£°æ˜æ¢æˆå¦‚ä¸‹å½¢å¼ï¼Œé‚£ä¹ˆä½ åœ¨ç»„ä»¶ä¸­è‡ªå·±æ‰“å‡ºçš„æ—¥å¿—ä¹Ÿä¼šå¸¦æœ‰è¯·æ±‚IDå‰ç¼€ã€‚

```java
private final LFLog logger = LFLoggerManager.getLogger(FlowExecutor.class);
```

å…¶ä¸­`LFLog`è¿™ä¸ªç±»æ˜¯ç»§æ‰¿è‡ªslf4jçš„`Logger`ç±»çš„ï¼Œæ‰€ä»¥å®ƒçš„ä½¿ç”¨æ–¹å¼å’Œ`Logger`æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚

ä½ åªéœ€è¦æŠŠå®šä¹‰æ¢ä¸€ä¸‹å°±okäº†ã€‚

å¦‚æœåœ¨ä¸€ä¸ªé“¾è·¯ä¸­ç›¸åŒè¯·æ±‚çš„æ—¥å¿—éƒ½æ‹¥æœ‰åŒä¸€ä¸ªè¯·æ±‚IDï¼Œé‚£ä¹ˆå¯¹äºå®šä½é—®é¢˜æ¥è¯´ï¼Œä¼šå¾ˆæ–¹ä¾¿ã€‚æ¨èå¤§å®¶ä½¿ç”¨æ­¤ç‰¹æ€§ã€‚

# ğŸŒ­ä¸åŒæ ¼å¼è§„åˆ™åŠ è½½

æœ‰äº›å°ä¼™ä¼´åœ¨é…ç½®è§„åˆ™æ—¶ï¼Œå› ä¸ºç‰¹æ®ŠåŸå› ï¼Œéœ€è¦åŒæ—¶åŠ è½½2ç§ä¸åŒçš„é…ç½®ï¼Œç”šè‡³æ˜¯é…ç½®æºï¼Œæ¯”å¦‚ï¼š

```properties
liteflow.rule-source=multipleType/flow.el.xml,multipleType/flow.el.json
```

è¿™ç§æ¨¡å¼åœ¨æ­£å¸¸ä¸‹ä¼šè§£æå¤±è´¥ï¼Œä½†æ˜¯LiteFLowæä¾›äº†ä¸€ä¸ªå‚æ•°å»æ”¯æŒè¿™ä¸ªç‰¹æ€§ï¼Œå¦‚æœå‡ºç°ä¸åŒçš„ç±»å‹çš„é…ç½®ï¼Œéœ€è¦åŠ ä¸Šè¿™ä¸ªå±æ€§ï¼š

```properties
liteflow.support-multiple-type=true
```

# ğŸ¥—å¼‚æ­¥çº¿ç¨‹æ± è‡ªå®šä¹‰

## [#](https://liteflow.yomahub.com/pages/7280ea/#é»˜è®¤å…¨å±€çº¿ç¨‹æ± )é»˜è®¤å…¨å±€çº¿ç¨‹æ± 

LiteFlowè‡ªå·±é»˜è®¤æœ‰å…¨å±€çº¿ç¨‹æ± ï¼Œå¹¶ä¸”çº¿ç¨‹æ± çš„å¤§å°ç­‰å‚æ•°å¯ä»¥é€šè¿‡è®¾ç½®ä»¥ä¸‹å‚æ•°æ¥è¿›è¡Œè®¾ç½®ï¼š

```properties
liteflow.when-max-wait-seconds=15
liteflow.when-max-workers=16
liteflow.when-queue-limit=512
```

## [#](https://liteflow.yomahub.com/pages/7280ea/#è‡ªå®šä¹‰å…¨å±€çº¿ç¨‹æ± )è‡ªå®šä¹‰å…¨å±€çº¿ç¨‹æ± 

ä½†æ˜¯å¦‚æœä½ è¦å¯¹çº¿ç¨‹æ± æœ‰ç‰¹æ®ŠåŒ–çš„è¦æ±‚ï¼ŒLiteFlowä¹Ÿæ”¯æŒè‡ªå®šä¹‰çº¿ç¨‹æ± çš„è®¾ç½®ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‡ªå®šä¹‰çº¿ç¨‹æ± åªé€‚ç”¨äºå¹¶è¡Œç»„ä»¶ï¼Œè¿™ä¸ªå‚æ•°å¯¹äºåŒæ­¥ç»„ä»¶æ¥è¯´å¹¶æ— ä½œç”¨ã€‚è€Œä¸”ä¸€æ—¦è®¾ç½®äº†ä½ è‡ªå®šä¹‰çš„çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆä»¥ä¸Šå‚æ•°å°†ä¸ä¼šå†æœ‰ç”¨ã€‚å¯¹äºçº¿ç¨‹æ± çš„æ‰€æœ‰å‚æ•°çš„å®šä¹‰ï¼Œéƒ½å–å†³äºä½ è‡ªå·±äº†ã€‚

é¦–å…ˆä½ å¯ä»¥è¿™æ ·å®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ± çš„Builderï¼š

```java
public class CustomThreadBuilder implements ExecutorBuilder {
    @Override
    public ExecutorService buildExecutor() {
        return Executors.newCachedThreadPool();
    }
}
```

ç„¶åæŠŠä½ çš„BuilderåŠ å…¥LiteFlowçš„é…ç½®ä¸­ï¼Œspringbootçš„è¯ï¼Œä½ å¯ä»¥è¿™æ ·é…ç½®ï¼š

```properties
liteflow.thread-executor-class=com.yomahub.liteflow.test.customThreadPool.CustomThreadBuilder
```

å¦‚æœæ˜¯springçš„è¯ï¼Œä½ å¯ä»¥è¿™æ ·é…ç½®ï¼š

```xml
<bean id="liteflowConfig" class="com.yomahub.liteflow.property.LiteflowConfig">
	<property name="ruleSource" value="customThreadPool/flow.el.xml"/>
    <property name="threadExecutorClass" value="com.yomahub.liteflow.test.customThreadPool.CustomThreadBuilder"/>
</bean>

<bean id="flowExecutor" class="com.yomahub.liteflow.core.FlowExecutor">
  <property name="liteflowConfig" ref="liteflowConfig"/>
</bean>
```

è¿™æ ·ï¼ŒLiteFlowåœ¨å¯åŠ¨çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨é€šè¿‡ä½ å£°æ˜çš„BuilderåŠ è½½åˆ°è‡ªå®šä¹‰çš„çº¿ç¨‹æ± äº†ã€‚

## [#](https://liteflow.yomahub.com/pages/7280ea/#whençº§åˆ«çš„å•ç‹¬çº¿ç¨‹æ± )`WHEN`çº§åˆ«çš„å•ç‹¬çº¿ç¨‹æ± 

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä½ çš„å¼‚æ­¥èŠ‚ç‚¹å¯èƒ½ä¸éœ€è¦ä¸€ä¸ªå…¨å±€çš„çº¿ç¨‹æ± ï¼Œå¸Œæœ›å¯¹æ¯ç»„å¼‚æ­¥èŠ‚ç‚¹è¿›è¡Œå•ç‹¬çš„çº¿ç¨‹æ± è®¾å®šã€‚

æ¯”å¦‚æˆ‘ç°åœ¨æƒ³å¯¹ä»¥ä¸‹2ä¸ªæµç¨‹å¼‚æ­¥èŠ‚ç‚¹è¿›è¡Œè®¾ç½®ä¸åŒçš„çº¿ç¨‹æ± :

```xml
<chain name="chain1">
    WHEN(a, b);
</chain>

<chain name="chain2">
    WHEN(c, d);
</chain>
```

é‚£ä¹ˆç°åœ¨ä½ å¯ä»¥è¿™ä¹ˆåš

é¦–å…ˆå®ç°2ä¸ªè‡ªå·±çš„çº¿ç¨‹æ± ï¼š

```java
public class CustomThreadExecutor1 implements ExecutorBuilder {

    @Override
    public ExecutorService buildExecutor() {
        //æ„é€ ä½ è‡ªå®šä¹‰çš„çº¿ç¨‹æ± 
    }
}
public class CustomThreadExecutor2 implements ExecutorBuilder {

    @Override
    public ExecutorService buildExecutor() {
        //æ„é€ ä½ è‡ªå®šä¹‰çš„çº¿ç¨‹æ± 
    }
}
```

ç„¶åä½ å¦‚ä¸‹å£°æ˜å°±okäº†ï¼š

```xml
<chain name="chain1">
    WHEN(a, b).threadPool("com.yomahub.liteflow.test.customWhenThreadPool.CustomThreadExecutor1");
</chain>
<chain name="chain2">
    WHEN(c, d).threadPool("com.yomahub.liteflow.test.customWhenThreadPool.CustomThreadExecutor2");
</chain>
```

## [#](https://liteflow.yomahub.com/pages/7280ea/#ä¼˜å…ˆçº§)ä¼˜å…ˆçº§

å¦‚æœå…¨å±€å’Œ`Condition`éƒ½é…ç½®è‡ªå®šä¹‰çº¿ç¨‹æ± çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆä½¿ç”¨`Condition`ä¸Šé…ç½®çš„çº¿ç¨‹æ± ã€‚

# ğŸ¿è‡ªå®šä¹‰ç»„ä»¶æ‰§è¡Œå™¨

LiteFlowå…è®¸ç”¨æˆ·å®šä¹‰è‡ªå®šä¹‰ç»„ä»¶æ‰§è¡Œå™¨ï¼Œé€šè¿‡è¿™ä¸ªå¯ä»¥åœ¨æ‰§è¡Œç»„ä»¶æ—¶ï¼ŒåŠ å…¥è‡ªå®šä¹‰ä»£ç ï¼Œé‡å†™é‡è¯•ç­–ç•¥ã€‚å½“ç„¶å…¶ä»–æ–¹å¼ä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸åŒçš„ç›®çš„ï¼Œæ¯”å¦‚è¯´ç»„ä»¶åˆ‡é¢åŠŸèƒ½ã€‚

å¦‚æœä½ æ²¡æœ‰éå¸¸æ˜ç¡®è¿™ä¸ªåŠŸèƒ½æ˜¯å¹²ä»€ä¹ˆçš„ï¼Œå»ºè®®è¿˜æ˜¯ç”¨é»˜è®¤çš„æ–¹å¼ã€‚(å…¶å®å°±æ˜¯ä¸ç”¨çœ‹æ­¤ç« èŠ‚çš„æ„æ€)

## [#](https://liteflow.yomahub.com/pages/46bbed/#å…¨å±€ç»„ä»¶æ‰§è¡Œå™¨)å…¨å±€ç»„ä»¶æ‰§è¡Œå™¨

å¯¹äºè‡ªå®šä¹‰ç»„ä»¶æ‰§è¡Œå™¨ï¼Œä½ å¯ä»¥åœ¨å…¨å±€ä¸Šè¿›è¡Œæ›¿æ¢ã€‚é»˜è®¤çš„ç»„ä»¶æ‰§è¡Œå™¨ä¸ºï¼š`com.yomahub.liteflow.flow.executor.DefaultNodeExecutor`

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ›¿æ¢å…¨å±€é»˜è®¤ç»„ä»¶æ‰§è¡Œå™¨ï¼š

```properties
liteflow.node-executor-class=com.yomahub.liteflow.test.nodeExecutor.CustomerDefaultNodeExecutor
```

è‡ªå®šä¹‰ç»„ä»¶æ‰§è¡Œå™¨éœ€è¦ç»§æ‰¿`com.yomahub.liteflow.entity.executor.NodeExecutor`ã€‚

```java
public class CustomerDefaultNodeExecutor extends NodeExecutor {
    @Override
    public void execute(NodeComponent instance) throws Exception {
        LOG.info("ä½¿ç”¨customerDefaultNodeExecutorè¿›è¡Œæ‰§è¡Œ");
        super.execute(instance);
      
      	//åœ¨è¿™é‡Œä½ å¯ä»¥åŠ å…¥è‡ªå·±çš„ä»£ç ï¼ŒåŒ…æ‹¬ä¸Šé¢çš„ä»£ç éƒ½å¯ä»¥å»æ‰
      	//ä½†æ˜¯è¦ç¡®ä¿è‡³å°‘è¦è°ƒç”¨instance.execute()ï¼Œå¦ç»„ä»¶å°±çœŸçš„æ— æ³•è¢«æ­£ç¡®æ‰§è¡Œäº†
    }
}
```

## [#](https://liteflow.yomahub.com/pages/46bbed/#å•ä¸ªç»„ä»¶é…ç½®ç‰¹æ®Šçš„æ‰§è¡Œå™¨)å•ä¸ªç»„ä»¶é…ç½®ç‰¹æ®Šçš„æ‰§è¡Œå™¨

é™¤äº†å…¨å±€æ‰§è¡Œå™¨ï¼Œå•ä¸ªç»„ä»¶ä¹Ÿæ”¯æŒé…ç½®è‡ªå®šä¹‰æ‰§è¡Œå™¨ã€‚

ä½ éœ€è¦åœ¨å®šä¹‰ç»„ä»¶çš„æ—¶å€™ï¼Œå®ç°`getNodeExecutorClass` æ–¹æ³•ï¼š

```java
@LiteflowComponent("d")
public class DCmp extends NodeComponent {

    @Override
    public void process() {
        System.out.println("DCmp executed!");
    }

    @Override
    public Class<? extends NodeExecutor> getNodeExecutorClass() {
        return CustomerNodeExecutorAndCustomRetry.class;
    }
}
```

## [#](https://liteflow.yomahub.com/pages/46bbed/#ä¼˜å…ˆçº§)ä¼˜å…ˆçº§

å¦‚æœå…¨å±€å’Œå•ä¸ªç»„ä»¶éƒ½é…ç½®è‡ªå®šä¹‰æ‰§è¡Œå™¨çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆä½¿ç”¨å•ä¸ªç»„ä»¶ä¸Šé…ç½®çš„æ‰§è¡Œå™¨ã€‚

## [#](https://liteflow.yomahub.com/pages/46bbed/#è‡ªå®šä¹‰æ‰§è¡Œå™¨å¯¹äºé‡è¯•åŠŸèƒ½çš„å½±å“)è‡ªå®šä¹‰æ‰§è¡Œå™¨å¯¹äºé‡è¯•åŠŸèƒ½çš„å½±å“

å› ä¸ºé‡è¯•çš„é€»è¾‘æ˜¯åœ¨é»˜è®¤æ‰§è¡Œå™¨é‡Œé¢å®ç°çš„ã€‚æ‰€ä»¥å¦‚æœä½ è‡ªå·±é…ç½®äº†è‡ªå®šä¹‰æ‰§è¡Œå™¨ï¼Œé‚£ä¹ˆé‡è¯•çš„åŠŸèƒ½éœ€è¦ä½ è‡ªå·±å»å®ç°ã€‚å¹¶ä¸”å…¨å±€é‡è¯•å‚æ•°é…ç½®è¿˜æœ‰`@LiteflowRetry`åŠŸèƒ½æ ‡ç­¾å°†å¤±æ•ˆã€‚

å½“ç„¶ä½ è‡ªå·±å®ç°çš„è‡ªå®šä¹‰æ‰§è¡Œå™¨ï¼Œè¿˜æ˜¯å¯ä»¥æ‹¿åˆ°é‡è¯•å‚æ•°ï¼Œè‡ªå·±å†™ç‰¹æ®Šçš„é‡è¯•ç­–ç•¥çš„ã€‚åªä¸è¿‡è¿™ä¸€åˆ‡éƒ½éœ€è¦è‡ªå·±å»å®Œæˆã€‚è¿™ç‚¹è¦æ³¨æ„ä¸‹ã€‚



# ğŸ¥ç®€å•ç›‘æ§

LiteFlowæä¾›äº†ç®€å•çš„ç›‘æ§ï¼Œç›®å‰åªç»Ÿè®¡ä¸€ä¸ªæŒ‡æ ‡ï¼šæ¯ä¸ªç»„ä»¶çš„å¹³å‡è€—æ—¶

é»˜è®¤æ¯5åˆ†é’Ÿä¼šæ‰“å°ä¸€æ¬¡(å¯ä»¥è‡ªå·±è°ƒæ•´)ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®è€—æ—¶æ—¶é•¿å€’åºæ’çš„ã€‚

å…³äºç›‘æ§é…ç½®é»˜è®¤çš„å‚æ•°å¦‚ä¸‹ï¼š

```properties
#æ˜¯å¦å¯ç”¨ç›‘æ§
liteflow.monitor.enable-log=false
#ç›‘æ§é˜Ÿåˆ—çš„å¤§å°
liteflow.monitor.queue-limit=200
#ç›‘æ§å»¶è¿Ÿå¤šå°‘æ¯«ç§’æ‰“å°
liteflow.monitor.delay=300000
#ç›‘æ§æ¯éš”å¤šå°‘æ¯«ç§’æ‰“å°
liteflow.monitor.period=300000
```

# ğŸ§‰XMLçš„DTD

LiteFlowä»2.9.1ç‰ˆæœ¬èµ·ï¼Œå¯¹XMLå¢åŠ äº†DTDï¼Œæ–¹ä¾¿åœ¨XMLé‡Œä½œä¸€äº›æ£€æŸ¥å’Œæé†’çº¦æŸã€‚

å…·ä½“å¼•ç”¨æ–¹æ³•ä¸ºï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE flow PUBLIC  "liteflow" "liteflow.dtd">
<flow>
    <chain name="chain1">
        THEN(a,b,WHEN(c,d));
    </chain>
</flow>
```

æç¤º

å½“ç„¶ä¸åŠ ä¹Ÿæ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œå› ä¸ºLiteFlow xmlèŠ‚ç‚¹éå¸¸ç®€å•ï¼Œå¹¶æ²¡æœ‰å¾ˆå¤šçš„èŠ‚ç‚¹æ ‡ç­¾éœ€è¦è®°å¿†ã€‚