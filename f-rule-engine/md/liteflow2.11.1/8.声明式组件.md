# 8.å£°æ˜å¼ç»„ä»¶

# ğŸ¥­ä»€ä¹ˆå«å£°æ˜å¼ç»„ä»¶

ä½•è°“å£°æ˜å¼ç»„ä»¶ï¼Ÿ

ä¹‹å‰ç« èŠ‚ä»‹ç»çš„æ™®é€šç»„ä»¶å’Œæ¡ä»¶ç»„ä»¶ï¼Œåœ¨å†™æ³•ä¸Šéœ€è¦ä½ è‡ªå·±å»å®šä¹‰ä¸€ä¸ªç±»å»ç»§æ‰¿`NodeComponent`æˆ–è€…`NodeSwitchComponent`ã€‚è¿™æ ·ä¸€æ–¹é¢é€ æˆäº†è€¦åˆï¼Œå¦ä¸€æ–¹é¢ç”±äºjavaæ˜¯å•ç»§æ‰¿åˆ¶ï¼Œæ‰€ä»¥ä½¿ç”¨è€…å°±æ— æ³•å†å»ç»§æ‰¿è‡ªå·±çš„ç±»äº†ï¼Œåœ¨è‡ªç”±åº¦ä¸Šå°±å°‘äº†å¾ˆå¤šç©æ³•ã€‚

å£°æ˜å¼ç»„ä»¶è¿™ä¸€ç‰¹æ€§å…è®¸ä½ è‡ªå®šä¹‰çš„ç»„ä»¶ä¸ç»§æ‰¿ä»»ä½•ç±»å’Œå®ç°ä»»ä½•æ¥å£ï¼Œæ™®é€šçš„ç±»ä¹Ÿå¯ä»¥ä¾é æ³¨è§£æ¥å®ŒæˆLiteFlowç»„ä»¶çš„å£°æ˜ã€‚

ç”šè‡³äºä½ å¯ä»¥ç”¨ä¸€ä¸ªç±»å»å®šä¹‰å¤šä¸ªç»„ä»¶ï¼Œä»…ä»…ä¾é æ³¨è§£å°±å¯ä»¥å®Œæˆï¼Œè¿™ä¸ªç‰¹æ€§ä¹Ÿå«åšæ–¹æ³•çº§åˆ«å¼å£°æ˜ã€‚

# ğŸ§…ç±»çº§åˆ«å¼å£°æ˜

ç±»çº§åˆ«å¼å£°æ˜ä¸»è¦ç”¨å¤„å°±æ˜¯é€šè¿‡æ³¨è§£å½¢å¼è®©æ™®é€šçš„java beanå˜æˆLiteFlowçš„ç»„ä»¶ã€‚æ— éœ€é€šè¿‡ç»§æ‰¿ç±»æˆ–è€…å®ç°æ¥å£çš„æ–¹å¼ã€‚

ç”±äºLiteFlowçš„ç»„ä»¶å¸¸è§„æ–¹å¼ä¸‹éœ€è¦ç»§æ‰¿ç±»æ¥å®šä¹‰ï¼Œä½¿å¾—ä½ æ— æ³•å†ç»§æ‰¿è‡ªå·±ä¸šåŠ¡çš„ç±»äº†ã€‚è¿™ä¸ªç‰¹æ€§å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯å’Œå¸¸è§„ç»„ä»¶ä¸€æ ·ï¼Œéœ€è¦ä¸€ä¸ªç±»å¯¹åº”ä¸€ä¸ªç»„ä»¶ã€‚

## [#](https://liteflow.yomahub.com/pages/18f548/#æ™®é€šç»„ä»¶çš„å£°æ˜)æ™®é€šç»„ä»¶çš„å£°æ˜

ä½ å¯ä»¥å¦‚ä¸‹å»è¿›è¡Œä¸€ä¸ªæ™®é€šç»„ä»¶çš„å£°æ˜ï¼š

```java
@LiteflowComponent("a")
@LiteflowCmpDefine
public class ACmp{
  
	@LiteflowMethod(LiteFlowMethodEnum.PROCESS)
	public void processAcmp(NodeComponent bindCmp) {
		System.out.println("ACmp executed!");
	}

	@LiteflowMethod(LiteFlowMethodEnum.IS_ACCESS)
	public boolean isAcmpAccess(NodeComponent bindCmp){
		return true;
	}

	@LiteflowMethod(LiteFlowMethodEnum.BEFORE_PROCESS)
	public void beforeAcmp(NodeComponent bindCmp){
		System.out.println("before A");
	}

	@LiteflowMethod(LiteFlowMethodEnum.AFTER_PROCESS)
	public void afterAcmp(NodeComponent bindCmp){
		System.out.println("after A");
	}

	@LiteflowMethod(LiteFlowMethodEnum.ON_SUCCESS)
	public void onAcmpSuccess(NodeComponent bindCmp){
		System.out.println("Acmp success");
	}

	@LiteflowMethod(LiteFlowMethodEnum.ON_ERROR)
	public void onAcmpError(NodeComponent bindCmp, Exception e){
		System.out.println("Acmp error");
	}
	
	@LiteflowMethod(LiteFlowMethodEnum.IS_END)
	public boolean isAcmpEnd(NodeComponent bindCmp) {
		return false;
	}
}
```

ä½¿ç”¨è€…æ— éœ€ç»§æ‰¿`NodeComponent`äº†ï¼Œåœ¨ä½ å®šä¹‰çš„ç±»ä¸Šï¼Œåªè¦ç±»ä¸ŠåŠ ä¸Š`LiteflowCmpDefine`æ³¨è§£ï¼Œç›¸åº”çš„æ–¹æ³•ä¸ŠåŠ ä¸Š`LiteflowMethod`æ³¨è§£ï¼Œå³å¯å®Œæˆå¯¹ä»»æ„è‡ªå®šä¹‰ç±»çš„ç»„ä»¶åŒ–å·¥ä½œã€‚

å…¶ä¸­`LiteFlowMethod`çš„ä½œç”¨æ˜¯æŠŠä½ è‡ªå·±çš„å®šä¹‰çš„æ–¹æ³•æ˜ å°„æˆç»„ä»¶çš„æ–¹æ³•ã€‚é™¤äº†æœ‰ç¤ºä¾‹ä¸Šçš„å€¼å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æ˜ å°„æ–¹æ³•ã€‚å…·ä½“å¯ä»¥çœ‹ä¸‹[æ™®é€šç»„ä»¶](https://liteflow.yomahub.com/pages/8486fb/)ç« èŠ‚ã€‚

æ³¨æ„ç‚¹1

å…³äºå‚æ•°çš„å‚æ•°ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–¹æ³•ä¸Šå‚æ•°å¿…é¡»ä¼ å…¥`NodeComponent bindCmp`è¿™ä¸ªå‚æ•°ï¼Œè€Œä¸”å¿…é¡»æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ã€‚

æ¯”å¦‚åŸå…ˆçš„`process()`ï¼Œé‚£ä¹ˆåœ¨å£°æ˜å¼é‡Œå°±æ˜¯`yourMethodName(NodeComponent bindCmp)`ã€‚

å¦‚æœæ˜¯åŸå…ˆçš„`onError(Exception e)`ï¼Œé‚£ä¹ˆåœ¨å£°æ˜å¼é‡Œå°±æ˜¯`yourMethodName(NodeComponent bindCmp, Exception e)`ã€‚

è§„å¾‹å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯åŸå…ˆçš„å‚æ•°ä¿ç•™ï¼Œåœ¨ç¬¬ä¸€ä¸ªä½ç½®æ’å…¥`NodeComponent`å¯¹è±¡ï¼Œä»£æ›¿åŸå…ˆçš„`this`ã€‚

ä»¥å‰è·å–ä¸Šä¸‹æ–‡Beanæ˜¯ç”¨`this`å…³é”®å­—ï¼Œç°åœ¨åªéœ€ä»bindCmpä¸­è·å–å°±å¯ä»¥äº†ã€‚

æ–¹æ³•çš„åç§°å¯ä»¥å®šä¹‰æˆä½ æƒ³è¦çš„ä»»ä½•æ–¹å¼ã€‚è¿™ä¸ªå¹¶æ— é™åˆ¶ã€‚

æ³¨æ„ç‚¹2

è‡ªå·±å®šä¹‰æ–¹æ³•æ—¶ï¼Œè¿”å›å€¼è¦å’Œå¸¸è§„ç»„ä»¶é‡Œçš„å¯¹åº”æ–¹æ³•è¿”å›å€¼ä¸€è‡´ã€‚æ¯”å¦‚æ™®é€šç»„ä»¶çš„`process`æ–¹æ³•æ˜¯ä¸è¿”å›çš„ï¼Œæ¯”å¦‚IFç»„ä»¶çš„`processIf`æ–¹æ³•æ˜¯è¿”å›å¸ƒå°”å€¼çš„ã€‚

å¦‚æœå†™é”™ï¼Œä¹Ÿä¼šå‘ç”Ÿä¸€ç‚¹å¼‚å¸¸ï¼Œå¯èƒ½ä¼šå¢åŠ ä½ çš„æ’æŸ¥æ—¶é—´ã€‚

## [#](https://liteflow.yomahub.com/pages/18f548/#é€‰æ‹©ç»„ä»¶çš„å£°æ˜)é€‰æ‹©ç»„ä»¶çš„å£°æ˜

å£°æ˜é€‰æ‹©ç»„ä»¶åœ¨ç±»å’Œæ–¹æ³•ä¸Šéƒ½éœ€è¦åŠ ä¸Š`NodeTypeEnum.SWITCH`å‚æ•°ã€‚

```java
@Component("e")
@LiteflowCmpDefine(NodeTypeEnum.SWITCH)
public class ECmp{

    @LiteflowMethod(value = LiteFlowMethodEnum.PROCESS_SWITCH, nodeType = NodeTypeEnum.SWITCH)
    public String processSwitch(NodeComponent bindCmp) throws Exception {
        System.out.println("Ecomp executed!");
        return "g";
    }
}
```

## [#](https://liteflow.yomahub.com/pages/18f548/#æ¡ä»¶ç»„ä»¶çš„å£°æ˜)æ¡ä»¶ç»„ä»¶çš„å£°æ˜

å£°æ˜é€‰æ‹©ç»„ä»¶åœ¨ç±»å’Œæ–¹æ³•ä¸Šéƒ½éœ€è¦åŠ ä¸Š`NodeTypeEnum.IF`å‚æ•°ã€‚

```java
@Component("x")
@LiteflowCmpDefine(NodeTypeEnum.IF)
public class XCmp{

	@LiteflowMethod(value = LiteFlowMethodEnum.IF, nodeType = NodeTypeEnum.IF)
	public boolean processIf(NodeComponent bindCmp) throws Exception {
		//do your biz
		return true;
	}
}
```

## [#](https://liteflow.yomahub.com/pages/18f548/#æ•°å€¼å¾ªç¯ç»„ä»¶çš„å£°æ˜)æ•°å€¼å¾ªç¯ç»„ä»¶çš„å£°æ˜

å£°æ˜é€‰æ‹©ç»„ä»¶åœ¨ç±»å’Œæ–¹æ³•ä¸Šéƒ½éœ€è¦åŠ ä¸Š`NodeTypeEnum.FOR`å‚æ•°ã€‚

```java
@Component("x")
@LiteflowCmpDefine(NodeTypeEnum.FOR)
public class XCmp{

	@LiteflowMethod(value = LiteFlowMethodEnum.PROCESS_FOR, nodeType = NodeTypeEnum.FOR)
	public int processFor(NodeComponent bindCmp) throws Exception {
		//do your biz
		return 10;
	}
}
```

## [#](https://liteflow.yomahub.com/pages/18f548/#æ¡ä»¶å¾ªç¯ç»„ä»¶çš„å£°æ˜)æ¡ä»¶å¾ªç¯ç»„ä»¶çš„å£°æ˜

å£°æ˜é€‰æ‹©ç»„ä»¶åœ¨ç±»å’Œæ–¹æ³•ä¸Šéƒ½éœ€è¦åŠ ä¸Š`NodeTypeEnum.WHILE`å‚æ•°ã€‚

```java
@Component("x")
@LiteflowCmpDefine(NodeTypeEnum.WHILE)
public class XCmp{

	@LiteflowMethod(value = LiteFlowMethodEnum.PROCESS_WHILE, nodeType = NodeTypeEnum.WHILE)
	public boolean processWhile(NodeComponent bindCmp) throws Exception {
		//get your while flag
		boolean flag = xxxxxx;
		return flag;
	}
}
```

## [#](https://liteflow.yomahub.com/pages/18f548/#é€€å‡ºå¾ªç¯ç»„ä»¶çš„å£°æ˜)é€€å‡ºå¾ªç¯ç»„ä»¶çš„å£°æ˜

å£°æ˜é€‰æ‹©ç»„ä»¶åœ¨ç±»å’Œæ–¹æ³•ä¸Šéƒ½éœ€è¦åŠ ä¸Š`NodeTypeEnum.BREAK`å‚æ•°ã€‚

```java
@Component("x")
@LiteflowCmpDefine(NodeTypeEnum.BREAK)
public class XCmp{

	@LiteflowMethod(value = LiteFlowMethodEnum.PROCESS_BREAK, nodeType = NodeTypeEnum.BREAK)
	public boolean processBreak(NodeComponent bindCmp) throws Exception {
		//get your break flag
		boolean flag = xxxxxx;
		return flag;
	}
}
```

## [#](https://liteflow.yomahub.com/pages/18f548/#æ³¨æ„ç‚¹)æ³¨æ„ç‚¹

æç¤º

å¯¹äºç±»é‡Œçš„å…¶ä»–æ–¹æ³•ï¼Œä¹Ÿéƒ½å’Œ`processXxx`ä¸€æ ·çš„æ–¹å¼å»å£°æ˜ã€‚

# ğŸ¥¥æ–¹æ³•çº§åˆ«å¼å£°æ˜

LiteFlowä»v2.9.0ç‰ˆå¼€å§‹æ¨å‡ºäº†æ–¹æ³•çº§åˆ«çš„å£°æ˜ç‰¹æ€§ã€‚

æ–¹æ³•çº§åˆ«å¼å£°æ˜å¯ä»¥è®©ç”¨æˆ·åœ¨ä¸€ä¸ªç±»ä¸­é€šè¿‡æ³¨è§£å®šä¹‰å¤šä¸ªç»„ä»¶ï¼Œæ›´åŠ çš„çµæ´»ã€‚

å¦‚æœä½ æœ‰éå¸¸å¤šçš„ç»„ä»¶ï¼ŒåˆåŒæ—¶æƒ³é¿å…ç±»çš„å®šä¹‰è¿‡å¤šçš„é—®é¢˜ï¼Œé‚£è¿™ä¸ªç‰¹æ€§éå¸¸é€‚åˆè¿™ç§éœ€æ±‚ã€‚

ä½ å¯ä»¥åƒè¿™æ ·æ¥åœ¨ä¸€ä¸ªbeané‡Œå®šä¹‰å¤šä¸ªç»„ä»¶ï¼š

```java
@LiteflowComponent
public class CmpConfig {

    //æ™®é€šç»„ä»¶çš„å®šä¹‰
    @LiteflowMethod(value = LiteFlowMethodEnum.PROCESS, nodeId = "a", nodeName = "Aç»„ä»¶")
    public void processA(NodeComponent bindCmp) {
        ...
    }

    //SWITCHç»„ä»¶çš„å®šä¹‰
    @LiteflowMethod(value = LiteFlowMethodEnum.PROCESS_SWITCH, nodeId = "b", nodeName = "Bç»„ä»¶", nodeType = NodeTypeEnum.SWITCH)
    public String processB(NodeComponent bindCmp) {
        ...
    }
    
    //IFç»„ä»¶çš„å®šä¹‰
    @LiteflowMethod(value = LiteFlowMethodEnum.PROCESS_IF, nodeId = "c", nodeName = "Cç»„ä»¶", nodeType = NodeTypeEnum.IF)
    public boolean processC(NodeComponent bindCmp) {
        ...
    }
    
    //FORç»„ä»¶çš„å®šä¹‰
    @LiteflowMethod(value = LiteFlowMethodEnum.PROCESS_FOR, nodeId = "d", nodeName = "Dç»„ä»¶", nodeType = NodeTypeEnum.FOR)
    public int processD(NodeComponent bindCmp) {
        ...
    }
    
    //WHILEç»„ä»¶çš„å®šä¹‰
    @LiteflowMethod(value = LiteFlowMethodEnum.PROCESS_WHILE, nodeId = "e", nodeName = "Eç»„ä»¶", nodeType = NodeTypeEnum.WHILE)
    public int processE(NodeComponent bindCmp) {
        ...
    }
    
    //BREAKç»„ä»¶çš„å®šä¹‰
    @LiteflowMethod(value = LiteFlowMethodEnum.PROCESS_BREAK, nodeId = "f", nodeName = "Fç»„ä»¶", nodeType = NodeTypeEnum.BREAK)
    public int processF(NodeComponent bindCmp) {
        ...
    }
}
```

æ³¨æ„ç‚¹1

è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºæ–¹æ³•çº§åˆ«å£°æ˜ç‰¹æ€§æ¥è¯´ï¼Œ`@LiteflowMethod`æ³¨è§£ä¸Šçš„`nodeId`ä¸€å®šè¦å†™ã€‚

LiteFlowä»v2.10.6å¼€å§‹ï¼Œæ–°å¢äº†`nodeName`çš„å±æ€§ã€‚æ–¹ä¾¿å¯¹å£°æ˜å¼çš„ç»„ä»¶è¿›è¡Œå‘½åã€‚è¿™ä¸ªå±æ€§æ˜¯å¯é€‰çš„ã€‚

æ™®é€šç»„ä»¶ä¸Šçš„`nodeType`å› ä¸ºæœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥å¯ä»¥ä¸å†™ï¼Œä½†æ˜¯ä¸ºäº†ç†è§£æ¸…æ™°ï¼Œè¿˜æ˜¯å»ºè®®å¤§å®¶åŠ ä¸Š`nodeType = NodeTypeEnum.COMMON`ã€‚

æ³¨æ„ç‚¹2

è‡ªå·±å®šä¹‰æ–¹æ³•æ—¶ï¼Œè¿”å›å€¼è¦å’Œå¸¸è§„ç»„ä»¶é‡Œçš„å¯¹åº”æ–¹æ³•è¿”å›å€¼ä¸€è‡´ã€‚æ¯”å¦‚æ™®é€šç»„ä»¶çš„`process`æ–¹æ³•æ˜¯ä¸è¿”å›çš„ï¼Œæ¯”å¦‚IFç»„ä»¶çš„`processIf`æ–¹æ³•æ˜¯è¿”å›å¸ƒå°”å€¼çš„ã€‚

å¦‚æœå†™é”™ï¼Œä¹Ÿä¼šå‘ç”Ÿä¸€ç‚¹å¼‚å¸¸ï¼Œå¯èƒ½ä¼šå¢åŠ ä½ çš„æ’æŸ¥æ—¶é—´ã€‚

å¯¹äºå…¶ä»–ç»„ä»¶çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„å£°æ˜æ–¹å¼ï¼Œæ¯”å¦‚æˆ‘åœ¨ä¸€ä¸ªç±»é‡Œå®šä¹‰2ä¸ªç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶åˆ†åˆ«å®ç°3ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š

```java
@LiteflowComponent
public class CmpConfig {

    @LiteflowMethod(value = LiteFlowMethodEnum.PROCESS, nodeId = "a", nodeType = NodeTypeEnum.COMMON)
    public void processA(NodeComponent bindCmp) {
        ...
    }

    @LiteflowMethod(value = LiteFlowMethodEnum.IS_ACCESS, nodeId = "a", nodeType = NodeTypeEnum.COMMON)
    public boolean isAccessA(NodeComponent bindCmp){
        ...
    }

    @LiteflowMethod(value = LiteFlowMethodEnum.ON_SUCCESS, nodeId = "a", nodeType = NodeTypeEnum.COMMON)
    public void onSuccessA(NodeComponent bindCmp){
        ...
    }

    @LiteflowMethod(value = LiteFlowMethodEnum.PROCESS_IF, nodeId = "f", nodeType = NodeTypeEnum.IF)
    public boolean processF(NodeComponent bindCmp) {
        ...
    }

    @LiteflowMethod(value = LiteFlowMethodEnum.IS_ACCESS, nodeId = "f", nodeType = NodeTypeEnum.IF)
    public boolean isAccessF(NodeComponent bindCmp){
        ...
    }

    @LiteflowMethod(value = LiteFlowMethodEnum.ON_SUCCESS, nodeId = "f", nodeType = NodeTypeEnum.IF)
    public void onSuccessF(NodeComponent bindCmp){
        ...
    }
}
```